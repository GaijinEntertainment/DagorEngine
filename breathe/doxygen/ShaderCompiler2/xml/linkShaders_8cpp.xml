<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.7" xml:lang="en-US">
  <compounddef id="linkShaders_8cpp" kind="file" language="C++">
    <compoundname>linkShaders.cpp</compoundname>
    <includes refid="linkShaders_8h" local="yes">linkShaders.h</includes>
    <incdepgraph>
      <node id="88">
        <label>DebugLevel.h</label>
        <link refid="DebugLevel_8h"/>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>blkHash.h</label>
        <link refid="blkHash_8h"/>
      </node>
      <node id="81">
        <label>boolVar.h</label>
        <link refid="boolVar_8h"/>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>commonUtils.h</label>
        <link refid="commonUtils_8h"/>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="73">
        <label>compileResult.h</label>
        <link refid="compileResult_8h"/>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="70">
        <label>const3d.h</label>
        <link refid="const3d_8h"/>
        <childnode refid="39" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>cppStcode.h</label>
        <link refid="cppStcode_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>cppStcodeAssembly.h</label>
        <link refid="cppStcodeAssembly_8h"/>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>cppStcodeBuilder.h</label>
        <link refid="cppStcodeBuilder_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="89">
        <label>cppStcodePlatformInfo.h</label>
        <link refid="cppStcodePlatformInfo_8h"/>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="64">
        <label>cppStcodeUtils.h</label>
        <link refid="cppStcodeUtils_8h"/>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
      </node>
      <node id="52">
        <label>globVar.h</label>
        <link refid="globVar_8h"/>
        <childnode refid="53" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
      </node>
      <node id="87">
        <label>globalConfig.h</label>
        <link refid="globalConfig_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>hash.h</label>
        <link refid="hash_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
      </node>
      <node id="50">
        <label>hashStrings.h</label>
        <link refid="hashStrings_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
      </node>
      <node id="28">
        <label>hlslRegisters.h</label>
        <link refid="hlslRegisters_8h"/>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
      </node>
      <node id="69">
        <label>hlslStage.h</label>
        <link refid="hlslStage_8h"/>
        <childnode refid="70" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
      </node>
      <node id="48">
        <label>hwAssembly.h</label>
        <link refid="hwAssembly_8h"/>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="59">
        <label>intervals.h</label>
        <link refid="intervals_8h"/>
      </node>
      <node id="1">
        <label>linkShaders.cpp</label>
        <link refid="linkShaders_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>linkShaders.h</label>
        <link refid="linkShaders_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>nameMap.h</label>
        <link refid="nameMap_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="82">
        <label>namedConst.h</label>
        <link refid="namedConst_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="43">
        <label>processes.h</label>
        <link refid="processes_8h"/>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="60">
        <label>samplers.h</label>
        <link refid="samplers_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
      </node>
      <node id="91">
        <label>shAssumes.h</label>
        <link refid="shAssumes_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>shCompContext.h</label>
        <link refid="shCompContext_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>shCompilationInfo.h</label>
        <link refid="shCompilationInfo_8h"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
      </node>
      <node id="78">
        <label>shErrorReporting.h</label>
        <link refid="shErrorReporting_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="29">
        <label>shLog.h</label>
        <link refid="shLog_8h"/>
      </node>
      <node id="63">
        <label>shMacro.h</label>
        <link refid="shMacro_8h"/>
      </node>
      <node id="92">
        <label>shSemCode.h</label>
        <link refid="shSemCode_8h"/>
      </node>
      <node id="9">
        <label>shTargetContext.h</label>
        <link refid="shTargetContext_8h"/>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="68" relation="include">
        </childnode>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="66">
        <label>shTargetStorage.h</label>
        <link refid="shTargetStorage_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
      </node>
      <node id="58">
        <label>shVarVecTypes.h</label>
        <link refid="shVarVecTypes_8h"/>
      </node>
      <node id="68">
        <label>shaderBytecodeCache.h</label>
        <link refid="shaderBytecodeCache_8h"/>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>shaderSave.h</label>
        <link refid="shaderSave_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>shaderTab.h</label>
        <link refid="shaderTab_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="62">
        <label>shlexterm.h</label>
        <link refid="shlexterm_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="77">
        <label>stcodeBytecode.h</label>
        <link refid="stcodeBytecode_8h"/>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="78" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>varMap.h</label>
        <link refid="varMap_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>varTypes.h</label>
        <link refid="varTypes_8h"/>
      </node>
      <node id="83">
        <label>variablesMerger.h</label>
        <link refid="variablesMerger_8h"/>
        <childnode refid="61" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="86" relation="include">
        </childnode>
      </node>
      <node id="55">
        <label>3d/dag_texMgr.h</label>
      </node>
      <node id="24">
        <label>EASTL/algorithm.h</label>
      </node>
      <node id="32">
        <label>EASTL/array.h</label>
      </node>
      <node id="86">
        <label>EASTL/bitvector.h</label>
      </node>
      <node id="84">
        <label>EASTL/fixed_vector.h</label>
      </node>
      <node id="85">
        <label>EASTL/map.h</label>
      </node>
      <node id="17">
        <label>EASTL/optional.h</label>
      </node>
      <node id="16">
        <label>EASTL/string.h</label>
      </node>
      <node id="65">
        <label>EASTL/string_view.h</label>
      </node>
      <node id="71">
        <label>EASTL/type_traits.h</label>
      </node>
      <node id="40">
        <label>EASTL/unique_ptr.h</label>
      </node>
      <node id="74">
        <label>EASTL/vector.h</label>
      </node>
      <node id="80">
        <label>EASTL/vector_map.h</label>
      </node>
      <node id="90">
        <label>EASTL/vector_set.h</label>
      </node>
      <node id="33">
        <label>cstdint</label>
      </node>
      <node id="27">
        <label>cstring</label>
      </node>
      <node id="23">
        <label>dag/dag_vector.h</label>
      </node>
      <node id="22">
        <label>debug/dag_assert.h</label>
      </node>
      <node id="79">
        <label>debug/dag_debug.h</label>
      </node>
      <node id="39">
        <label>drv/3d/dag_consts.h</label>
      </node>
      <node id="67">
        <label>drv/3d/dag_renderStates.h</label>
      </node>
      <node id="56">
        <label>drv/3d/dag_sampler.h</label>
      </node>
      <node id="30">
        <label>generic/dag_enumerate.h</label>
      </node>
      <node id="31">
        <label>generic/dag_expected.h</label>
      </node>
      <node id="44">
        <label>generic/dag_fixedMoveOnlyFunction.h</label>
      </node>
      <node id="7">
        <label>generic/dag_tab.h</label>
      </node>
      <node id="26">
        <label>hash/BLAKE3/blake3.h</label>
      </node>
      <node id="49">
        <label>ioSys/dag_dataBlock.h</label>
      </node>
      <node id="53">
        <label>math/dag_color.h</label>
      </node>
      <node id="54">
        <label>math/integer/dag_IPoint4.h</label>
      </node>
      <node id="72">
        <label>memory</label>
      </node>
      <node id="35">
        <label>memory/dag_mem.h</label>
      </node>
      <node id="75">
        <label>memory/dag_memBase.h</label>
      </node>
      <node id="38">
        <label>shaders/dag_shaderVarType.h</label>
      </node>
      <node id="47">
        <label>shaders/dag_shaders.h</label>
      </node>
      <node id="36">
        <label>shaders/shExprTypes.h</label>
      </node>
      <node id="37">
        <label>shaders/shFunc.h</label>
      </node>
      <node id="42">
        <label>shaders/shader_layout.h</label>
      </node>
      <node id="34">
        <label>shaders/slotTexturesRange.h</label>
      </node>
      <node id="61">
        <label>shsyn.h</label>
      </node>
      <node id="41">
        <label>ska_hash_map/flat_hash_map2.hpp</label>
      </node>
      <node id="8">
        <label>util/dag_bindump_ext.h</label>
      </node>
      <node id="15">
        <label>util/dag_globDef.h</label>
      </node>
      <node id="6">
        <label>util/dag_oaHashNameMap.h</label>
      </node>
      <node id="14">
        <label>util/dag_safeArg.h</label>
      </node>
      <node id="76">
        <label>util/dag_simpleString.h</label>
      </node>
      <node id="51">
        <label>util/dag_stdint.h</label>
      </node>
      <node id="46">
        <label>util/dag_string.h</label>
      </node>
      <node id="13">
        <label>utility</label>
      </node>
    </incdepgraph>
    <innerclass refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase" prot="public">anonymous_namespace{linkShaders.cpp}::RecompileJobBase</innerclass>
    <innerclass refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout" prot="public">anonymous_namespace{linkShaders.cpp}::RecompileJobBase::MappingFileLayout</innerclass>
    <innerclass refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileVPRogJob" prot="public">anonymous_namespace{linkShaders.cpp}::RecompileVPRogJob</innerclass>
    <innerclass refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompilePShJob" prot="public">anonymous_namespace{linkShaders.cpp}::RecompilePShJob</innerclass>
    <innerclass refid="structIndexReplacmentInfo" prot="public">IndexReplacmentInfo</innerclass>
    <innernamespace refid="namespaceanonymous__namespace_02linkShaders_8cpp_03">anonymous_namespace{linkShaders.cpp}</innernamespace>
      <sectiondef kind="func">
      <memberdef kind="function" id="linkShaders_8cpp_1a89ad15dc480db392b8a38daa4a8d4745" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void close_shader_class</definition>
        <argsstring>()</argsstring>
        <name>close_shader_class</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="43" column="6" bodyfile="linkShaders.cpp" bodystart="43" bodyend="43"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a9dd11b723e582c5a303b746fde7c5efa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void add_shader_class</definition>
        <argsstring>(ShaderClass *sc, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_shader_class</name>
        <param>
          <type><ref refid="classShaderClass" kindref="compound">ShaderClass</ref> *</type>
          <declname>sc</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="45" column="6" bodyfile="linkShaders.cpp" bodystart="45" bodyend="50"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1aa26fc4d6261cf25ea202c85a47deed61" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int add_fshader</definition>
        <argsstring>(dag::ConstSpan&lt; unsigned &gt; code, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_fshader</name>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>code</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="52" column="5" bodyfile="linkShaders.cpp" bodystart="52" bodyend="70"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a58a37ce7dcfb6642f4498171a2a8f2cd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int add_vprog</definition>
        <argsstring>(dag::ConstSpan&lt; unsigned &gt; vs, dag::ConstSpan&lt; unsigned &gt; hs, dag::ConstSpan&lt; unsigned &gt; ds, dag::ConstSpan&lt; unsigned &gt; gs, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_vprog</name>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>vs</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>hs</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>ds</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>gs</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="75" column="5" bodyfile="linkShaders.cpp" bodystart="75" bodyend="261"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a7da67626e07b07a7baaf902a28ea7d8e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>static bool is_hlsl_debug</definition>
        <argsstring>()</argsstring>
        <name>is_hlsl_debug</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="264" column="13" bodyfile="linkShaders.cpp" bodystart="264" bodyend="264"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1ab063c21a0baeb0b136cf1f1d2e0e0a41" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>VertexProgramAndPixelShaderIdents</type>
        <definition>VertexProgramAndPixelShaderIdents add_phase_one_progs</definition>
        <argsstring>(dag::ConstSpan&lt; unsigned &gt; vs, dag::ConstSpan&lt; unsigned &gt; hs, dag::ConstSpan&lt; unsigned &gt; ds, dag::ConstSpan&lt; unsigned &gt; gs, dag::ConstSpan&lt; unsigned &gt; ps, SemanticShaderPass::EnableFp16State enableFp16, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_phase_one_progs</name>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>vs</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>hs</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>ds</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>gs</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; unsigned &gt;</type>
          <declname>ps</declname>
        </param>
        <param>
          <type><ref refid="structSemanticShaderPass_1_1EnableFp16State" kindref="compound">SemanticShaderPass::EnableFp16State</ref></type>
          <declname>enableFp16</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="272" column="35" bodyfile="linkShaders.cpp" bodystart="272" bodyend="344"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a1f02d91b048e2e45cbeb15a8e03557f7" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>eastl::vector&lt; <ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref> &gt;</type>
        <definition>static eastl::vector&lt; IndexReplacmentInfo &gt; dedup_table</definition>
        <argsstring>(Tab&lt; dag::ConstSpan&lt; unsigned &gt; &gt; &amp;table, const char *name)</argsstring>
        <name>dedup_table</name>
        <param>
          <type>Tab&lt; dag::ConstSpan&lt; unsigned &gt; &gt; &amp;</type>
          <declname>table</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="598" column="22" bodyfile="linkShaders.cpp" bodystart="598" bodyend="639"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1ab161d2c887a66aabfab15eaa624e8fb6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>eastl::vector&lt; <ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref> &gt;</type>
        <definition>static eastl::vector&lt; IndexReplacmentInfo &gt; empty_fill_table</definition>
        <argsstring>(Tab&lt; dag::ConstSpan&lt; unsigned &gt; &gt; &amp;table, const char *name)</argsstring>
        <name>empty_fill_table</name>
        <param>
          <type>Tab&lt; dag::ConstSpan&lt; unsigned &gt; &gt; &amp;</type>
          <declname>table</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="641" column="22" bodyfile="linkShaders.cpp" bodystart="641" bodyend="666"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1aaebdab790f5e0ab1215b39e3ace6ebfd" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int16_t</type>
        <definition>static int16_t patch_index</definition>
        <argsstring>(int16_t old, const eastl::vector&lt; IndexReplacmentInfo &gt; &amp;table, const char *name)</argsstring>
        <name>patch_index</name>
        <param>
          <type>int16_t</type>
          <declname>old</declname>
        </param>
        <param>
          <type>const eastl::vector&lt; <ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref> &gt; &amp;</type>
          <declname>table</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="668" column="16" bodyfile="linkShaders.cpp" bodystart="668" bodyend="675"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1aba4a334fb0cf0470a802037389c839e2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void patch_passes</definition>
        <argsstring>(const eastl::vector&lt; IndexReplacmentInfo &gt; &amp;vprg, const eastl::vector&lt; IndexReplacmentInfo &gt; &amp;fsh, shc::TargetContext &amp;ctx)</argsstring>
        <name>patch_passes</name>
        <param>
          <type>const eastl::vector&lt; <ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref> &gt; &amp;</type>
          <declname>vprg</declname>
        </param>
        <param>
          <type>const eastl::vector&lt; <ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref> &gt; &amp;</type>
          <declname>fsh</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="677" column="13" bodyfile="linkShaders.cpp" bodystart="677" bodyend="697"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a2d7d04073933e210e5225ed0d881432a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void dedup_shaders</definition>
        <argsstring>(shc::TargetContext &amp;ctx)</argsstring>
        <name>dedup_shaders</name>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="699" column="13" bodyfile="linkShaders.cpp" bodystart="699" bodyend="724"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1aa120dd755705808199f189664dd5edce" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void recompile_shaders</definition>
        <argsstring>(shc::TargetContext &amp;ctx)</argsstring>
        <name>recompile_shaders</name>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="726" column="6" bodyfile="linkShaders.cpp" bodystart="726" bodyend="788"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a96fa1850596561b85a77a8b6e78407fd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int add_stcode</definition>
        <argsstring>(dag::ConstSpan&lt; int &gt; code, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_stcode</name>
        <param>
          <type>dag::ConstSpan&lt; int &gt;</type>
          <declname>code</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="791" column="5" bodyfile="linkShaders.cpp" bodystart="791" bodyend="806"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1ace100897f3e189920a57708fbc77bbaa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void add_stcode_validation_mask</definition>
        <argsstring>(int stcode_id, shader_layout::StcodeConstValidationMask *mask, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_stcode_validation_mask</name>
        <param>
          <type>int</type>
          <declname>stcode_id</declname>
        </param>
        <param>
          <type>shader_layout::StcodeConstValidationMask *</type>
          <declname>mask</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="808" column="6" bodyfile="linkShaders.cpp" bodystart="808" bodyend="822"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a6fcfe634aff00a097359a147d9bc188a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int add_render_state</definition>
        <argsstring>(const shaders::RenderState &amp;rs, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_render_state</name>
        <param>
          <type>const shaders::RenderState &amp;</type>
          <declname>rs</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="824" column="12" bodyfile="linkShaders.cpp" bodystart="824" bodyend="833"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a07de43c7fcfd3647d78f0a2111368280" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int add_render_state</definition>
        <argsstring>(const SemanticShaderPass &amp;state, shc::TargetContext &amp;ctx)</argsstring>
        <name>add_render_state</name>
        <param>
          <type>const <ref refid="structSemanticShaderPass" kindref="compound">SemanticShaderPass</ref> &amp;</type>
          <declname>state</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="835" column="5" bodyfile="linkShaders.cpp" bodystart="835" bodyend="905"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a95e9f2844f9737f2e97ee881900ca283" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ld_add_fshader</definition>
        <argsstring>(TabFsh &amp;code, int upper, shc::TargetContext &amp;ctx)</argsstring>
        <name>ld_add_fshader</name>
        <param>
          <type><ref refid="shaderTab_8h_1a2cd908b8b863e1a62398c1db79c3cb1a" kindref="member">TabFsh</ref> &amp;</type>
          <declname>code</declname>
        </param>
        <param>
          <type>int</type>
          <declname>upper</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="907" column="12" bodyfile="linkShaders.cpp" bodystart="907" bodyend="923"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a572be31cfe2c7cbc98627efe7342f82a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ld_add_vprog</definition>
        <argsstring>(TabVpr &amp;code, int upper, shc::TargetContext &amp;ctx)</argsstring>
        <name>ld_add_vprog</name>
        <param>
          <type><ref refid="shaderTab_8h_1ae2d7923f0c75afa2dd22f7993339df8e" kindref="member">TabVpr</ref> &amp;</type>
          <declname>code</declname>
        </param>
        <param>
          <type>int</type>
          <declname>upper</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="925" column="12" bodyfile="linkShaders.cpp" bodystart="925" bodyend="941"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a4bf07cae8abae5fa8dfc3d872402bac8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void count_shader_stats</definition>
        <argsstring>(unsigned &amp;uniqueFshBytesInFile, unsigned &amp;uniqueFshCountInFile, unsigned &amp;uniqueVprBytesInFile, unsigned &amp;uniqueVprCountInFile, unsigned &amp;stcodeBytes, const shc::TargetContext &amp;ctx)</argsstring>
        <name>count_shader_stats</name>
        <param>
          <type>unsigned &amp;</type>
          <declname>uniqueFshBytesInFile</declname>
        </param>
        <param>
          <type>unsigned &amp;</type>
          <declname>uniqueFshCountInFile</declname>
        </param>
        <param>
          <type>unsigned &amp;</type>
          <declname>uniqueVprBytesInFile</declname>
        </param>
        <param>
          <type>unsigned &amp;</type>
          <declname>uniqueVprCountInFile</declname>
        </param>
        <param>
          <type>unsigned &amp;</type>
          <declname>stcodeBytes</declname>
        </param>
        <param>
          <type>const <ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="943" column="6" bodyfile="linkShaders.cpp" bodystart="943" bodyend="963"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a0afff863ca5cb06fa55b30a7453d2d04" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void link_shaders_fsh_and_vpr</definition>
        <argsstring>(ShadersBindump &amp;bindump, Tab&lt; int &gt; &amp;fsh_lnktbl, Tab&lt; int &gt; &amp;vpr_lnktbl, shc::TargetContext &amp;ctx)</argsstring>
        <name>link_shaders_fsh_and_vpr</name>
        <param>
          <type><ref refid="structShadersBindump" kindref="compound">ShadersBindump</ref> &amp;</type>
          <declname>bindump</declname>
        </param>
        <param>
          <type>Tab&lt; int &gt; &amp;</type>
          <declname>fsh_lnktbl</declname>
        </param>
        <param>
          <type>Tab&lt; int &gt; &amp;</type>
          <declname>vpr_lnktbl</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="965" column="13" bodyfile="linkShaders.cpp" bodystart="965" bodyend="982"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a305d00d1fd0fdba5682b501ae71abe7b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool load_shaders_bindump</definition>
        <argsstring>(ShadersBindump &amp;shaders, bindump::IReader &amp;full_file_reader, shc::TargetContext &amp;ctx)</argsstring>
        <name>load_shaders_bindump</name>
        <param>
          <type><ref refid="structShadersBindump" kindref="compound">ShadersBindump</ref> &amp;</type>
          <declname>shaders</declname>
        </param>
        <param>
          <type>bindump::IReader &amp;</type>
          <declname>full_file_reader</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="984" column="6" bodyfile="linkShaders.cpp" bodystart="984" bodyend="1010"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a80685ae901a05b19dd81461d6117456a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bool</type>
        <definition>bool link_scripted_shaders</definition>
        <argsstring>(const uint8_t *mapped_data, int data_size, const char *filename, const char *source_name, shc::TargetContext &amp;ctx)</argsstring>
        <name>link_scripted_shaders</name>
        <param>
          <type>const uint8_t *</type>
          <declname>mapped_data</declname>
        </param>
        <param>
          <type>int</type>
          <declname>data_size</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>filename</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>source_name</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="1012" column="6" bodyfile="linkShaders.cpp" bodystart="1012" bodyend="1228"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1a3d948e926ac6e6c6574b37fda70e5f41" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void save_scripted_shaders</definition>
        <argsstring>(const char *filename, dag::ConstSpan&lt; SimpleString &gt; files, shc::TargetContext &amp;ctx, bool need_cppstcode_file_write)</argsstring>
        <name>save_scripted_shaders</name>
        <param>
          <type>const char *</type>
          <declname>filename</declname>
        </param>
        <param>
          <type>dag::ConstSpan&lt; SimpleString &gt;</type>
          <declname>files</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>bool</type>
          <declname>need_cppstcode_file_write</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="1230" column="6" bodyfile="linkShaders.cpp" bodystart="1230" bodyend="1336"/>
      </memberdef>
      <memberdef kind="function" id="linkShaders_8cpp_1ada36b76256c8c7e82e285ca2281bb944" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void update_shaders_timestamps</definition>
        <argsstring>(dag::ConstSpan&lt; SimpleString &gt; dependencies, shc::TargetContext &amp;ctx)</argsstring>
        <name>update_shaders_timestamps</name>
        <param>
          <type>dag::ConstSpan&lt; SimpleString &gt;</type>
          <declname>dependencies</declname>
        </param>
        <param>
          <type><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref> &amp;</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
<para>Update the timestamps of the shader classes. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>dependencies</parametername>
</parameternamelist>
<parameterdescription>
<para>The list of files that the shader classes depend on </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="note"><para>If dagor git repo is present and files are not locally git modified, the function will use the timestamp of the last commit for file dependencies. Otherwise, it will use the filesystem timestamp </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="linkShaders.cpp" line="1338" column="6" bodyfile="linkShaders.cpp" bodystart="1338" bodyend="1354"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>(C)<sp/>Gaijin<sp/>Games<sp/>KFT.<sp/><sp/>All<sp/>rights<sp/>reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="linkShaders_8h" kindref="compound">linkShaders.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="gitRunner_8h" kindref="compound">gitRunner.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="loadShaders_8h" kindref="compound">loadShaders.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="globalConfig_8h" kindref="compound">globalConfig.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="deSerializationContext_8h" kindref="compound">deSerializationContext.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="globVar_8h" kindref="compound">globVar.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="varMap_8h" kindref="compound">varMap.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="shcode_8h" kindref="compound">shcode.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="shaderSave_8h" kindref="compound">shaderSave.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="shLog_8h" kindref="compound">shLog.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="shCacheVer_8h" kindref="compound">shCacheVer.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="binDumpUtils_8h" kindref="compound">binDumpUtils.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;shaders/shUtils.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;shaders/shOpcodeFormat.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;shaders/shOpcode.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ioSys/dag_memIo.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ioSys/dag_chainedMemIo.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ioSys/dag_zlibIo.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ioSys/dag_zstdIo.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;osApiWrappers/dag_files.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;osApiWrappers/dag_cpuJobs.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;osApiWrappers/dag_miscApi.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;osApiWrappers/dag_direct.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math/random/dag_random.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;EASTL/vector.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;EASTL/algorithm.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="assemblyShader_8h" kindref="compound">assemblyShader.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="shCompiler_8h" kindref="compound">shCompiler.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="sha1__cache__version_8h" kindref="compound">sha1_cache_version.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="hashed__cache_8h" kindref="compound">hashed_cache.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="cppStcode_8h" kindref="compound">cppStcode.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;debug/dag_debug.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;drv/3d/dag_renderStates.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>_CROSS_TARGET_SPIRV</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;drv/shadersMetaData/spirv/compiled_meta_data.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a89ad15dc480db392b8a38daa4a8d4745" kindref="member">close_shader_class</ref>()<sp/>{<sp/><ref refid="namespaceShaderParser_1a8d3720af0f21bad15c0361671744eb12" kindref="member">ShaderParser::clear_per_file_caches</ref>();<sp/>}</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a9dd11b723e582c5a303b746fde7c5efa" kindref="member">add_shader_class</ref>(<ref refid="classShaderClass" kindref="compound">ShaderClass</ref><sp/>*sc,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="46"><highlight class="normal">{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!sc)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1abfaaaacd1519890b902eb99112e8b850" kindref="member">shaderClass</ref>.push_back(sc);</highlight></codeline>
<codeline lineno="50"><highlight class="normal">}</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1aa26fc4d6261cf25ea202c85a47deed61" kindref="member">add_fshader</ref>(dag::ConstSpan&lt;unsigned&gt;<sp/>code,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="53"><highlight class="normal">{</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!code.size())</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size()<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i].size()<sp/>==<sp/>code.size()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i].data()<sp/>==<sp/>code.data()<sp/>||<sp/>mem_eq(code,<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i].data())))</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.push_back(code);</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="70"><highlight class="normal">}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;osApiWrappers/dag_direct.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;osApiWrappers/dag_files.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a58a37ce7dcfb6642f4498171a2a8f2cd" kindref="member">add_vprog</ref>(dag::ConstSpan&lt;unsigned&gt;<sp/>vs,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>hs,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>ds,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>gs,</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="77"><highlight class="normal">{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!vs.size())</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>code<sp/>=<sp/>vs;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/>SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;<sp/>*comp_prog<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>_CROSS_TARGET_METAL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>G_ASSERT(hs.size()<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/>G_ASSERT(ds.size()<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/>G_ASSERT(vs.size());</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>its<sp/>mesh<sp/>shader<sp/>and<sp/>company</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(vs[0]<sp/>==<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;D11v&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>header<sp/>=<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX9v&apos;</highlight><highlight class="normal">),<sp/>new_header<sp/>=<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;MTLM&apos;</highlight><highlight class="normal">),<sp/>ms_size<sp/>=<sp/>data_size(vs),<sp/>as_size<sp/>=<sp/>data_size(gs);</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>combo_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(header)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(new_header)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ms_size)<sp/>+<sp/>ms_size<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(as_size)<sp/>+<sp/>as_size;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_prog<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>clear_and_resize(*comp_prog,<sp/>(combo_size<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)<sp/>-<sp/>1)<sp/>/<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>offset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>*data<sp/>=<sp/>(uint8_t<sp/>*)comp_prog-&gt;data();</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(data<sp/>+<sp/>offset,<sp/>&amp;header,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(header));</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>offset<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(header);</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(data<sp/>+<sp/>offset,<sp/>&amp;new_header,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(new_header));</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>offset<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(new_header);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(data<sp/>+<sp/>offset,<sp/>&amp;ms_size,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ms_size));</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>offset<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ms_size);</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(data<sp/>+<sp/>offset,<sp/>vs.data(),<sp/>ms_size);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>offset<sp/>+=<sp/>ms_size;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(data<sp/>+<sp/>offset,<sp/>&amp;as_size,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(as_size));</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>offset<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(as_size);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(as_size)</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(data<sp/>+<sp/>offset,<sp/>gs.data(),<sp/>as_size);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>offset<sp/>+=<sp/>as_size;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>code<sp/>=<sp/>make_span(*comp_prog);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="preprocessor">#elif<sp/>!_CROSS_TARGET_EMPTY</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hs.size()<sp/>||<sp/>ds.size()<sp/>||<sp/>gs.size()<sp/>||<sp/>vs[0]<sp/>==<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;D11v&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>_CROSS_TARGET_SPIRV</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cacheEntryPreamble<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t)<sp/>*<sp/>1;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>just<sp/>concatenates<sp/>each<sp/>blob<sp/>and<sp/>adds<sp/>some<sp/>chunk<sp/>headers<sp/>for<sp/>type<sp/>and<sp/>location<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>comboSize<sp/>=</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(spirv::CombinedChunk)<sp/>+<sp/>data_size(vs)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>chunkCount<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hs.size())</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboSize<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(spirv::CombinedChunk)<sp/>+<sp/>data_size(hs)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++chunkCount;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ds.size())</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboSize<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(spirv::CombinedChunk)<sp/>+<sp/>data_size(ds)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++chunkCount;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs.size())</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboSize<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(spirv::CombinedChunk)<sp/>+<sp/>data_size(gs)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++chunkCount;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_prog<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>clear_and_resize(*comp_prog,<sp/>(comboSize<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)<sp/>-<sp/>1)<sp/>/<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>pre<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">uint32_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(comp_prog-&gt;data());</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>magic<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">uint32_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(pre<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>count<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">uint32_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(magic<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>comboChunks<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">spirv::CombinedChunk<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(count<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>comboData<sp/>=<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(comboChunks<sp/>+<sp/>chunkCount);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>comboDataStart<sp/>=<sp/>comboData;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>fake<sp/>pre<sp/>id<sp/>to<sp/>pass<sp/>as<sp/>a<sp/>normal<sp/>shader</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>this<sp/>results<sp/>in<sp/>wrong<sp/>shader<sp/>used<sp/>bytes<sp/>statistics<sp/>at<sp/>the<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>*pre<sp/>=<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX9v&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>*magic<sp/>=<sp/>spirv::SPIR_V_COMBINED_BLOB_IDENT;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/>*count<sp/>=<sp/>chunkCount;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/>comboChunks-&gt;stage<sp/>=<sp/>VK_SHADER_STAGE_VERTEX_BIT;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>comboChunks-&gt;offset<sp/>=<sp/>comboData<sp/>-<sp/>comboDataStart;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/>comboChunks-&gt;size<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">uint32_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(data_size(vs)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>always<sp/>skip<sp/>over<sp/>first<sp/>uint32<sp/>as<sp/>it<sp/>stores<sp/>the<sp/>shader<sp/>type<sp/>magic<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(comboData,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(vs.data())<sp/>+<sp/>cacheEntryPreamble,<sp/>data_size(vs)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>comboData<sp/>+=<sp/>data_size(vs)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>++comboChunks;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hs.size())</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;stage<sp/>=<sp/>VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;offset<sp/>=<sp/>comboData<sp/>-<sp/>comboDataStart;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;size<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">uint32_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(data_size(hs)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>always<sp/>skip<sp/>over<sp/>first<sp/>uint32<sp/>as<sp/>it<sp/>stores<sp/>the<sp/>shader<sp/>type<sp/>magic<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(comboData,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(hs.data())<sp/>+<sp/>cacheEntryPreamble,<sp/>data_size(hs)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboData<sp/>+=<sp/>data_size(hs)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++comboChunks;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ds.size())</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;stage<sp/>=<sp/>VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;offset<sp/>=<sp/>comboData<sp/>-<sp/>comboDataStart;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;size<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">uint32_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(data_size(ds)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>always<sp/>skip<sp/>over<sp/>first<sp/>uint32<sp/>as<sp/>it<sp/>stores<sp/>the<sp/>shader<sp/>type<sp/>magic<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(comboData,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(ds.data())<sp/>+<sp/>cacheEntryPreamble,<sp/>data_size(ds)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboData<sp/>+=<sp/>data_size(ds)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++comboChunks;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs.size())</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;stage<sp/>=<sp/>VK_SHADER_STAGE_GEOMETRY_BIT;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;offset<sp/>=<sp/>comboData<sp/>-<sp/>comboDataStart;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboChunks-&gt;size<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">uint32_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(data_size(gs)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>always<sp/>skip<sp/>over<sp/>first<sp/>uint32<sp/>as<sp/>it<sp/>stores<sp/>the<sp/>shader<sp/>type<sp/>magic<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(comboData,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(gs.data())<sp/>+<sp/>cacheEntryPreamble,<sp/>data_size(gs)<sp/>-<sp/>cacheEntryPreamble);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comboData<sp/>+=<sp/>data_size(gs)<sp/>-<sp/>cacheEntryPreamble;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++comboChunks;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>code<sp/>=<sp/>make_span(*comp_prog);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight><highlight class="preprocessor">#elif<sp/>_CROSS_TARGET_DX12</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_prog<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>over<sp/>first<sp/>uint32_t<sp/>with<sp/>cache<sp/>tag</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>dx12::dxil::combineShaders(*comp_prog,<sp/>make_span(vs).subspan(1),<sp/>make_span(hs).subspan(hs.size()<sp/>?<sp/>1<sp/>:<sp/>0),</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>make_span(ds).subspan(ds.size()<sp/>?<sp/>1<sp/>:<sp/>0),<sp/>make_span(gs).subspan(gs.size()<sp/>?<sp/>1<sp/>:<sp/>0),<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX9v&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/>code<sp/>=<sp/>make_span(*comp_prog);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>vs_len<sp/>=<sp/>vs.size()<sp/>-<sp/>4,<sp/>hs_len<sp/>=<sp/>hs.size()<sp/>-<sp/>4,<sp/>ds_len<sp/>=<sp/>ds.size()<sp/>-<sp/>4,<sp/>gs_len<sp/>=<sp/>gs.size()<sp/>-<sp/>4;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hs_len<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>hs_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(hs[0]<sp/>==<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;D11h&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ds_len<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ds_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(ds[0]<sp/>==<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;D11d&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs_len<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gs_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(gs[0]<sp/>==<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;D11g&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/>G_ASSERT(vs[0]<sp/>==<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX9v&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/>Tab&lt;unsigned&gt;<sp/>comp_unp;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp.resize(9<sp/>+<sp/>vs_len<sp/>+<sp/>hs_len<sp/>+<sp/>ds_len<sp/>+<sp/>gs_len);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>mem_set_0(comp_unp);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[0]<sp/>=<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX11&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[1]<sp/>=<sp/>data_size(comp_unp)<sp/>-<sp/>elem_size(comp_unp)<sp/>*<sp/>4;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[2]<sp/>=<sp/>vs[2];</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[3]<sp/>=<sp/>vs[3];</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[4]<sp/>=<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX11&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[5]<sp/>=<sp/>vs_len;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[6]<sp/>=<sp/>hs_len<sp/>|<sp/>(hs.size()<sp/>?<sp/>hs[2]<sp/>&amp;<sp/>0xFF000000<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[7]<sp/>=<sp/>ds_len;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_unp[8]<sp/>=<sp/>gs_len;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(&amp;comp_unp[9],<sp/>&amp;vs[4],<sp/>elem_size(vs)<sp/>*<sp/>vs_len);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hs_len)</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(&amp;comp_unp[9<sp/>+<sp/>vs_len],<sp/>&amp;hs[4],<sp/>elem_size(hs)<sp/>*<sp/>hs_len);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ds_len)</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(&amp;comp_unp[9<sp/>+<sp/>vs_len<sp/>+<sp/>hs_len],<sp/>&amp;ds[4],<sp/>elem_size(ds)<sp/>*<sp/>ds_len);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(gs_len)</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(&amp;comp_unp[9<sp/>+<sp/>vs_len<sp/>+<sp/>hs_len<sp/>+<sp/>ds_len],<sp/>&amp;gs[4],<sp/>elem_size(gs)<sp/>*<sp/>gs_len);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>code<sp/>=<sp/>comp_unp;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>comp_prog<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>clear_and_resize(*comp_prog,<sp/>code.size());</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>mem_copy_from(*comp_prog,<sp/>code.data());</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/>code<sp/>=<sp/>make_span(*comp_prog);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>if<sp/>this<sp/>changes<sp/>finalize_xbox_one_shaders<sp/>has<sp/>to<sp/>be<sp/>updated<sp/>too!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size()<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i].size()<sp/>==<sp/>code.size()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i].data()<sp/>==<sp/>code.data()<sp/>||<sp/>mem_eq(code,<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i].data())))</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comp_prog)</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>comp_prog;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(comp_prog)</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>.push_back(comp_prog);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.push_back(code);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="261"><highlight class="normal">}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>_CROSS_TARGET_DX12</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_hlsl_debug()<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1a1ef797efe3855bf413cd788a87b4d6a5" kindref="member">hlslDebugLevel</ref><sp/>!=<sp/><ref refid="DebugLevel_8h_1a1a2e78e667f5d5bd44be96e3abc8a3eeab50339a10e1de285ac99d4c3990b8693" kindref="member">DebugLevel::NONE</ref>;<sp/>}</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>REPORT_RECOMPILE_PROGRESS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>REPORT<sp/>debug</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>REPORT(...)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal">VertexProgramAndPixelShaderIdents<sp/><ref refid="linkShaders_8cpp_1ab063c21a0baeb0b136cf1f1d2e0e0a41" kindref="member">add_phase_one_progs</ref>(dag::ConstSpan&lt;unsigned&gt;<sp/>vs,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>hs,</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>ds,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>gs,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>ps,</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><ref refid="structSemanticShaderPass_1_1EnableFp16State" kindref="compound">SemanticShaderPass::EnableFp16State</ref><sp/>enableFp16,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="275"><highlight class="normal">{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/>VertexProgramAndPixelShaderIdents<sp/>result{-1,<sp/>-1};</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>vShaderData<sp/>=<sp/>make_span(vs).subspan(vs.size()<sp/>?<sp/>1<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>hShaderData<sp/>=<sp/>make_span(hs).subspan(hs.size()<sp/>?<sp/>1<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>dShaderData<sp/>=<sp/>make_span(ds).subspan(ds.size()<sp/>?<sp/>1<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>gShaderData<sp/>=<sp/>make_span(gs).subspan(gs.size()<sp/>?<sp/>1<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>pShaderData<sp/>=<sp/>make_span(ps).subspan(ps.size()<sp/>?<sp/>1<sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>@TODO:<sp/>this<sp/>might<sp/>not<sp/>be<sp/>an<sp/>actual<sp/>hard<sp/>requirement,<sp/>but<sp/>only<sp/>of<sp/>our<sp/>API,<sp/>need<sp/>to<sp/>check</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1ad591dd4b977e7e7a832c8a6ef9e3b6bf" kindref="member">vsOrMs</ref><sp/>!=<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1a7ce49d8670320a52b4713a0eccd344e9" kindref="member">hs</ref><sp/>||<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1a7ce49d8670320a52b4713a0eccd344e9" kindref="member">hs</ref><sp/>!=<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1af03ad92139661849917571bc27bd483b" kindref="member">ds</ref><sp/>||<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1af03ad92139661849917571bc27bd483b" kindref="member">ds</ref><sp/>!=<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1a896e356f854a95da3e6dcd9231e9ba18" kindref="member">gsOrAs</ref>)</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>enabledStr<sp/>=<sp/>[](</highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>enabled)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>enabled<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;enabled&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;disabled&quot;</highlight><highlight class="normal">;<sp/>};</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5caae3b70b41400c8a36e8a094ac1dbe43c" kindref="member">SHLOG_ERROR</ref>,</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;All<sp/>vertex<sp/>program<sp/>shaders<sp/>have<sp/>to<sp/>either<sp/>have<sp/>all<sp/>halfs<sp/>enabled<sp/>or<sp/>disabled<sp/>for<sp/>two-phase<sp/>compilation.\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Got:<sp/>vs:<sp/>%s,<sp/>hs:<sp/>%s,<sp/>ds:<sp/>%s,<sp/>gs:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>enabledStr(enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1ad591dd4b977e7e7a832c8a6ef9e3b6bf" kindref="member">vsOrMs</ref>),<sp/>enabledStr(enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1a7ce49d8670320a52b4713a0eccd344e9" kindref="member">hs</ref>),<sp/>enabledStr(enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1af03ad92139661849917571bc27bd483b" kindref="member">ds</ref>),<sp/>enabledStr(enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1a896e356f854a95da3e6dcd9231e9ba18" kindref="member">gsOrAs</ref>));</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>rootSignatureDefinition<sp/>=</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>dx12::dxil::generateRootSignatureDefinition(vShaderData,<sp/>hShaderData,<sp/>dShaderData,<sp/>gShaderData,<sp/>pShaderData);</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size()<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dx12::dxil::comparePhaseOneVertexProgram(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i],<sp/>vShaderData,<sp/>hShaderData,<sp/>dShaderData,<sp/>gShaderData,</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rootSignatureDefinition))</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>result.vprog<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size()<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dx12::dxil::comparePhaseOnePixelShader(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i],<sp/>pShaderData,<sp/>rootSignatureDefinition))</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>result.fsh<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/>dx12::dxil::CompilationOptions<sp/>compileOptions;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/>compileOptions.optimize<sp/>=<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1a07709c18553c05f849ca4119010a3525" kindref="member">hlslOptimizationLevel</ref><sp/>?<sp/>true<sp/>:<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/>compileOptions.skipValidation<sp/>=<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1ae33db9d93363e2138ff51d9ecc66d555" kindref="member">hlslSkipValidation</ref>;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/>compileOptions.debugInfo<sp/>=<sp/>is_hlsl_debug();</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/>compileOptions.scarlettW32<sp/>=<sp/><ref refid="assemblyShader_8h_1a0f794d6b691ebbcb2261a57b0844976f" kindref="member">useScarlettWave32</ref>;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/>compileOptions.hlsl2021<sp/>=<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1a7931cab87a121710b0a7cc62aaf71609" kindref="member">hlsl2021</ref>;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/>compileOptions.enableFp16<sp/>=<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1ad591dd4b977e7e7a832c8a6ef9e3b6bf" kindref="member">vsOrMs</ref>;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(-1<sp/>==<sp/>result.vprog)</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>packed<sp/>=<sp/>dx12::dxil::combinePhaseOneVertexProgram(vShaderData,<sp/>hShaderData,<sp/>dShaderData,<sp/>gShaderData,<sp/>rootSignatureDefinition,</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX9v&apos;</highlight><highlight class="normal">),<sp/>compileOptions);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>result.vprog<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.push_back(*packed);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>.push_back(packed.release());</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/>compileOptions.enableFp16<sp/>=<sp/>enableFp16.<ref refid="structSemanticShaderPass_1_1EnableFp16State_1a31cd4803eafd7de81f1d3b0d87b2a7ca" kindref="member">psOrCs</ref>;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(-1<sp/>==<sp/>result.fsh)</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>packed<sp/>=<sp/>dx12::dxil::combinePhaseOnePixelShader(pShaderData,<sp/>rootSignatureDefinition,<sp/>_MAKE4C(</highlight><highlight class="stringliteral">&apos;DX9p&apos;</highlight><highlight class="normal">),<sp/>!gShaderData.empty(),</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>!hShaderData.empty()<sp/>&amp;&amp;<sp/>!dShaderData.empty(),<sp/>compileOptions);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>result.fsh<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.push_back(*packed);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>.push_back(packed.release());</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="344"><highlight class="normal">}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346" refid="namespaceanonymous__namespace_02linkShaders_8cpp_03" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal">{</highlight></codeline>
<codeline lineno="348" refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase" kindref="compound">RecompileJobBase</ref><sp/>:<sp/><ref refid="structshc_1_1Job" kindref="compound">shc::Job</ref></highlight></codeline>
<codeline lineno="349"><highlight class="normal">{</highlight></codeline>
<codeline lineno="350" refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout" kindref="compound">MappingFileLayout</ref></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout_1a0650299eadb4114d7da8c0310445ab98" kindref="member">ilSize</ref>;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout_1abd72a6e175f18f6f50b2f84ad6af066b" kindref="member">byteCodeVersion</ref>;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout_1aaaa52c4254ff9a6603c0302d305d4540" kindref="member">byteCodeSize</ref>;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1_1MappingFileLayout_1ae5b9da23817ada97592549e931738841" kindref="member">byteCodeHash</ref>[<ref refid="hashed__cache_8h_1ad6074dd11ab3c97c8135c43aab03ae95" kindref="member">HASH_SIZE</ref>];</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>compileTarget;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/>uint8_t<sp/>ilHash[<ref refid="hashed__cache_8h_1ad6074dd11ab3c97c8135c43aab03ae95" kindref="member">HASH_SIZE</ref>];</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>ilPath[420];</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase" kindref="compound">RecompileJobBase</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ct,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;cref)<sp/>:<sp/>compileTarget{ct},<sp/>ctx{cref}<sp/>{}</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/>eastl::unique_ptr&lt;SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;&gt;<sp/>load_cache(dag::ConstSpan&lt;unsigned&gt;<sp/>uncompiled,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*type_name)</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().useSha1Cache)</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*profile_name<sp/>=<sp/>dx12::dxil::Platform::XBOX_ONE<sp/>==<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().targetPlatform<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;xs&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a570b3b725357770701d8b56ea8518aea" kindref="member">HASH_CONTEXT</ref><sp/>ctx;</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1adcd60db457233e4a407009f6d4ceea48" kindref="member">HASH_INIT</ref>(&amp;ctx);</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1aff56e6812dd2a8d0b940648e0fa81ad0" kindref="member">HASH_UPDATE</ref>(&amp;ctx,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(uncompiled.data()),<sp/>data_size(uncompiled));</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a8fb0342e9d1a05b36d12bd79eee1b769" kindref="member">HASH_FINISH</ref>(&amp;ctx,<sp/>ilHash);</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>SNPRINTF(ilPath,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ilPath),<sp/></highlight><highlight class="stringliteral">&quot;%s/il/%s/%s/&quot;</highlight><highlight class="normal"><sp/><ref refid="hashed__cache_8h_1a3b3a37e25c4d802885e54d4dba344be3" kindref="member">HASH_LIST_STRING</ref>,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().sha1CacheDir,<sp/>type_name,<sp/>profile_name,</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a15a19082058efde09fbefa1a13bb96e3" kindref="member">HASH_LIST</ref>(ilHash));</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>file<sp/>=<sp/>df_open(ilPath,<sp/>DF_READ);</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file)</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>MappingFileLayout<sp/>mappingFile{};</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>readSize<sp/>=<sp/>df_read(file,<sp/>&amp;mappingFile,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(mappingFile));</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>df_close(file);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(readSize<sp/>&lt;<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(mappingFile)<sp/>||<sp/>mappingFile.ilSize<sp/>!=<sp/>data_size(uncompiled)<sp/>||</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mappingFile.byteCodeVersion<sp/>!=<sp/>sha1_cache_version)</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>byteCodePath[420];</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>SNPRINTF(byteCodePath,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(byteCodePath),<sp/></highlight><highlight class="stringliteral">&quot;%s/bc/%s/%s/&quot;</highlight><highlight class="normal"><sp/><ref refid="hashed__cache_8h_1a3b3a37e25c4d802885e54d4dba344be3" kindref="member">HASH_LIST_STRING</ref>,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().sha1CacheDir,<sp/>type_name,<sp/>profile_name,</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a15a19082058efde09fbefa1a13bb96e3" kindref="member">HASH_LIST</ref>(mappingFile.byteCodeHash));</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>byteCodeFile<sp/>=<sp/>df_open(byteCodePath,<sp/>DF_READ);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!byteCodeFile)</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>fileSize<sp/>=<sp/>df_length(byteCodeFile);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fileSize<sp/>!=<sp/>mappingFile.byteCodeSize<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t))</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>df_close(byteCodeFile);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>need<sp/>to<sp/>store<sp/>the<sp/>version<sp/>or<sp/>we<sp/>might<sp/>use<sp/>outdated<sp/>bins,<sp/>if<sp/>the<sp/>final<sp/>format<sp/>did<sp/>change.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>version<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>df_read(byteCodeFile,<sp/>&amp;version,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(version));</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(version<sp/>!=<sp/>sha1_cache_version)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>df_close(byteCodeFile);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>result<sp/>=<sp/>eastl::make_unique&lt;SmallTab&lt;unsigned,<sp/>TmpmemAlloc&gt;&gt;();</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/>clear_and_resize(*result,<sp/>mappingFile.byteCodeSize<sp/>/<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/>readSize<sp/>=<sp/>df_read(byteCodeFile,<sp/>result-&gt;data(),<sp/>data_size(*result));</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/>df_close(byteCodeFile);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(readSize<sp/>!=<sp/>data_size(*result))</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{};</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>store_cache(dag::ConstSpan&lt;unsigned&gt;<sp/>uncompiled,<sp/>dag::ConstSpan&lt;unsigned&gt;<sp/>compiled,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*type_name)</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().writeSha1Cache)</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*profile_name<sp/>=<sp/>dx12::dxil::Platform::XBOX_ONE<sp/>==<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().targetPlatform<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;x&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;xs&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>MappingFileLayout<sp/>mappingFile{};</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>mappingFile.ilSize<sp/>=<sp/>data_size(uncompiled);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>mappingFile.byteCodeSize<sp/>=<sp/>data_size(compiled);</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/>mappingFile.byteCodeVersion<sp/>=<sp/>sha1_cache_version;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a570b3b725357770701d8b56ea8518aea" kindref="member">HASH_CONTEXT</ref><sp/>ctx;</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1adcd60db457233e4a407009f6d4ceea48" kindref="member">HASH_INIT</ref>(&amp;ctx);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1aff56e6812dd2a8d0b940648e0fa81ad0" kindref="member">HASH_UPDATE</ref>(&amp;ctx,<sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="keyword">const<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(uncompiled.data()),<sp/>data_size(uncompiled));</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a8fb0342e9d1a05b36d12bd79eee1b769" kindref="member">HASH_FINISH</ref>(&amp;ctx,<sp/>mappingFile.byteCodeHash);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>bcPath[420];</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/>SNPRINTF(bcPath,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(bcPath),<sp/></highlight><highlight class="stringliteral">&quot;%s/bc/%s/%s/&quot;</highlight><highlight class="normal"><sp/><ref refid="hashed__cache_8h_1a3b3a37e25c4d802885e54d4dba344be3" kindref="member">HASH_LIST_STRING</ref>,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().sha1CacheDir,<sp/>type_name,<sp/>profile_name,</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a15a19082058efde09fbefa1a13bb96e3" kindref="member">HASH_LIST</ref>(mappingFile.byteCodeHash));</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/>DagorStat<sp/>bcInfo;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>tempPath[DAGOR_MAX_PATH];</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(df_stat(bcPath,<sp/>&amp;bcInfo)<sp/>!=<sp/>-1)</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>(bcInfo.size<sp/>!=<sp/>mappingFile.byteCodeSize)<sp/>{}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SNPRINTF(tempPath,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tempPath),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s_bc_%s_&quot;</highlight><highlight class="normal"><sp/><ref refid="hashed__cache_8h_1af6dcd12177a796015d8c3fefb0cbc208" kindref="member">HASH_TEMP_STRING</ref><sp/></highlight><highlight class="stringliteral">&quot;XXXXXX&quot;</highlight><highlight class="normal">,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().sha1CacheDir,<sp/>type_name,</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>profile_name,<sp/><ref refid="hashed__cache_8h_1a15a19082058efde09fbefa1a13bb96e3" kindref="member">HASH_LIST</ref>(mappingFile.byteCodeHash));</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>file<sp/>=<sp/>df_mkstemp(tempPath);</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file)</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>store<sp/>the<sp/>version<sp/>so<sp/>that<sp/>we<sp/>can<sp/>identify<sp/>if<sp/>a<sp/>cache<sp/>blob<sp/>is<sp/>outdated.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>version<sp/>=<sp/>sha1_cache_version;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>df_write(file,<sp/>&amp;version,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(version));</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>written<sp/>=<sp/>df_write(file,<sp/>compiled.data(),<sp/>data_size(compiled));</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>df_close(file);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(written<sp/>!=<sp/>data_size(compiled))</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dd_erase(tempPath);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dd_mkpath(bcPath);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!dd_rename(tempPath,<sp/>bcPath))</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dd_erase(tempPath);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/>SNPRINTF(tempPath,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tempPath),<sp/></highlight><highlight class="stringliteral">&quot;%s/%s_il_%s_&quot;</highlight><highlight class="normal"><sp/><ref refid="hashed__cache_8h_1af6dcd12177a796015d8c3fefb0cbc208" kindref="member">HASH_TEMP_STRING</ref><sp/></highlight><highlight class="stringliteral">&quot;XXXXXX&quot;</highlight><highlight class="normal">,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().sha1CacheDir,<sp/>type_name,<sp/>profile_name,</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hashed__cache_8h_1a15a19082058efde09fbefa1a13bb96e3" kindref="member">HASH_LIST</ref>(ilHash));</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>file<sp/>=<sp/>df_mkstemp(tempPath);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file)</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>written<sp/>=<sp/>df_write(file,<sp/>&amp;mappingFile,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(mappingFile));</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>df_close(file);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(written<sp/>!=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(mappingFile))</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dd_erase(tempPath);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>dd_mkpath(ilPath);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!dd_rename(tempPath,<sp/>ilPath))</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dd_erase(ilPath);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal">};</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499" refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileVPRogJob" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileVPRogJob" kindref="compound">RecompileVPRogJob</ref><sp/>:<sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase" kindref="compound">RecompileJobBase</ref></highlight></codeline>
<codeline lineno="500"><highlight class="normal">{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1ac23d299162f5aa9d118064b808f9add9" kindref="member">RecompileJobBase::RecompileJobBase</ref>;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>doJobBody()</highlight><highlight class="keyword"><sp/>override</highlight></codeline>
<codeline lineno="504"><highlight class="keyword"><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.storage();</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cache_name[]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;vp&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>writeCache<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>recompiledVProgBlob<sp/>=<sp/>load_cache(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[compileTarget],<sp/>cache_name);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!recompiledVProgBlob)</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>writeCache<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>recompiledVProg<sp/>=<sp/>dx12::dxil::recompileVertexProgram(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[compileTarget],<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().targetPlatform,</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().dx12PdbCacheDir,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1a1ef797efe3855bf413cd788a87b4d6a5" kindref="member">hlslDebugLevel</ref>,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1ab8150f9586651e5eee7b9c1237c43a93" kindref="member">hlslEmbedSource</ref>);</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!recompiledVProg)</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5ca6112bd3e7c5d175bac1569c33c1630ad" kindref="member">SHLOG_FATAL</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Recompilation<sp/>of<sp/>vprog<sp/>failed&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>recompiledVProgBlob<sp/>=<sp/>eastl::move(*recompiledVProg);</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(recompiledVProgBlob)</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ref<sp/>=<sp/>eastl::find_if(eastl::begin(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>),<sp/>eastl::end(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>),</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[cmp<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[compileTarget].data()](</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tab)<sp/>{<sp/>return<sp/>cmp<sp/>==<sp/>tab-&gt;data();<sp/>});</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;vprog<sp/>size<sp/>%u<sp/>-&gt;<sp/>%u&quot;</highlight><highlight class="normal">,<sp/>data_size(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[compileTarget]),<sp/>data_size(*recompiledVProgBlob));</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(writeCache)</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>store_cache(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[compileTarget],<sp/>*recompiledVProgBlob,<sp/>cache_name);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[compileTarget]<sp/>=<sp/>*recompiledVProgBlob;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(ref<sp/>!=<sp/>eastl::end(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>));</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ref<sp/>!=<sp/>eastl::end(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>))</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>*ref;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*ref<sp/>=<sp/>recompiledVProgBlob.release();</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>releaseJobBody()<sp/>{}</highlight></codeline>
<codeline lineno="543"><highlight class="normal">};</highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight></codeline>
<codeline lineno="545" refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompilePShJob" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompilePShJob" kindref="compound">RecompilePShJob</ref><sp/>:<sp/><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase" kindref="compound">RecompileJobBase</ref></highlight></codeline>
<codeline lineno="546"><highlight class="normal">{</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="structanonymous__namespace_02linkShaders_8cpp_03_1_1RecompileJobBase_1ac23d299162f5aa9d118064b808f9add9" kindref="member">RecompileJobBase::RecompileJobBase</ref>;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>doJobBody()</highlight><highlight class="keyword"><sp/>override</highlight></codeline>
<codeline lineno="550"><highlight class="keyword"><sp/><sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.storage();</highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cache_name[]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;fs&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>writeCache<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>recompiledFShBlob<sp/>=<sp/>load_cache(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[compileTarget],<sp/>cache_name);</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!recompiledFShBlob)</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>writeCache<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>recompiledFSh<sp/>=<sp/>dx12::dxil::recompilePixelSader(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[compileTarget],<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().targetPlatform,</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().dx12PdbCacheDir,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1a1ef797efe3855bf413cd788a87b4d6a5" kindref="member">hlslDebugLevel</ref>,<sp/><ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().<ref refid="structshc_1_1CompilerConfig_1ab8150f9586651e5eee7b9c1237c43a93" kindref="member">hlslEmbedSource</ref>);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!recompiledFSh)</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5ca6112bd3e7c5d175bac1569c33c1630ad" kindref="member">SHLOG_FATAL</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Recompilation<sp/>of<sp/>fsh<sp/>failed&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>recompiledFShBlob<sp/>=<sp/>eastl::move(*recompiledFSh);</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(recompiledFShBlob)</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ref<sp/>=<sp/>eastl::find_if(eastl::begin(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>),<sp/>eastl::end(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>),</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[cmp<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[compileTarget].data()](</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tab)<sp/>{<sp/>return<sp/>cmp<sp/>==<sp/>tab-&gt;data();<sp/>});</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;fsh<sp/>size<sp/>%u<sp/>-&gt;<sp/>%u&quot;</highlight><highlight class="normal">,<sp/>data_size(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[compileTarget]),<sp/>data_size(*recompiledFShBlob));</highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(writeCache)</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>store_cache(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[compileTarget],<sp/>*recompiledFShBlob,<sp/>cache_name);</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[compileTarget]<sp/>=<sp/>*recompiledFShBlob;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(ref<sp/>!=<sp/>eastl::end(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>));</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ref<sp/>!=<sp/>eastl::end(stor.<ref refid="structShaderTargetStorage_1a4448da2fd12af15508e56628b9576d66" kindref="member">shadersCompProg</ref>))</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>*ref;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*ref<sp/>=<sp/>recompiledFShBlob.release();</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>releaseJobBody()</highlight><highlight class="keyword"><sp/>override<sp/></highlight><highlight class="normal">{}</highlight></codeline>
<codeline lineno="589"><highlight class="normal">};</highlight></codeline>
<codeline lineno="590"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight></codeline>
<codeline lineno="592" refid="structIndexReplacmentInfo" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref></highlight></codeline>
<codeline lineno="593"><highlight class="normal">{</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structIndexReplacmentInfo_1a2c00a3209b0d7851565496c302794d3d" kindref="member">target</ref>;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structIndexReplacmentInfo_1abf87e154af1d81ba9075f4fe99dd1491" kindref="member">old</ref>;</highlight></codeline>
<codeline lineno="596"><highlight class="normal">};</highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>dedup_table(Tab&lt;dag::ConstSpan&lt;unsigned&gt;&gt;<sp/>&amp;table,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name)</highlight></codeline>
<codeline lineno="599"><highlight class="normal">{</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>result;</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(table.empty())</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Looking<sp/>for<sp/>recompiled<sp/>%s<sp/>duplicates...&quot;</highlight><highlight class="normal">,<sp/>name);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>o<sp/>=<sp/>0;<sp/>o<sp/>&lt;<sp/>table.size()<sp/>-<sp/>1;<sp/>++o)</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;base<sp/>=<sp/>table[o];</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(base.empty())</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>d<sp/>=<sp/>o<sp/>+<sp/>1;<sp/>d<sp/>&lt;<sp/>table.size();<sp/>++d)</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;cmp<sp/>=<sp/>table[d];</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cmp.size()<sp/>!=<sp/>base.size())</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!mem_eq(cmp,<sp/>base.data()))</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>cmp.reset();</highlight></codeline>
<codeline lineno="621"><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref><sp/>r;</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r.<ref refid="structIndexReplacmentInfo_1a2c00a3209b0d7851565496c302794d3d" kindref="member">target</ref><sp/>=<sp/>o;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r.<ref refid="structIndexReplacmentInfo_1abf87e154af1d81ba9075f4fe99dd1491" kindref="member">old</ref><sp/>=<sp/>d;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>result.push_back(r);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Found<sp/>%s<sp/>id<sp/>%u<sp/>as<sp/>duplicate<sp/>of<sp/>%u&quot;</highlight><highlight class="normal">,<sp/>name,<sp/>d,<sp/>o);</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>nothing<sp/>was<sp/>remapped<sp/>we<sp/>don&apos;t<sp/>need<sp/>to<sp/>fill<sp/>holes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result.empty())</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Found<sp/>%u<sp/>duplicates...&quot;</highlight><highlight class="normal">,<sp/>result.size());</highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(table.back().empty())</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/>table.pop_back();</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="639"><highlight class="normal">}</highlight></codeline>
<codeline lineno="640"><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>empty_fill_table(Tab&lt;dag::ConstSpan&lt;unsigned&gt;&gt;<sp/>&amp;table,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name)</highlight></codeline>
<codeline lineno="642"><highlight class="normal">{</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>result;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(table.empty())</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Filling<sp/>empty<sp/>slots<sp/>for<sp/>%s...&quot;</highlight><highlight class="normal">,<sp/>name);</highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>table.size();<sp/>++i)</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;base<sp/>=<sp/>table[i];</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!base.empty())</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structIndexReplacmentInfo" kindref="compound">IndexReplacmentInfo</ref><sp/>r;</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>r.<ref refid="structIndexReplacmentInfo_1a2c00a3209b0d7851565496c302794d3d" kindref="member">target</ref><sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/>r.<ref refid="structIndexReplacmentInfo_1abf87e154af1d81ba9075f4fe99dd1491" kindref="member">old</ref><sp/>=<sp/>table.size()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/>result.push_back(r);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Found<sp/>empty<sp/>%s<sp/>id<sp/>%u<sp/>mapping<sp/>%u<sp/>to<sp/>it&quot;</highlight><highlight class="normal">,<sp/>name,<sp/>r.<ref refid="structIndexReplacmentInfo_1a2c00a3209b0d7851565496c302794d3d" kindref="member">target</ref>,<sp/>r.<ref refid="structIndexReplacmentInfo_1abf87e154af1d81ba9075f4fe99dd1491" kindref="member">old</ref>);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>base<sp/>=<sp/>table.back();</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/>table.pop_back();</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="664"><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="666"><highlight class="normal">}</highlight></codeline>
<codeline lineno="667"><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>int16_t<sp/>patch_index(int16_t<sp/>old,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>&amp;table,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name)</highlight></codeline>
<codeline lineno="669"><highlight class="normal">{</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ref<sp/>=<sp/>eastl::find_if(begin(table),<sp/>end(table),<sp/>[old](</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;info)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>info.old<sp/>==<sp/>old;<sp/>});</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ref<sp/>==<sp/>end(table))</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>old;</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;patching<sp/>%s<sp/>id<sp/>from<sp/>%u<sp/>to<sp/>%u&quot;</highlight><highlight class="normal">,<sp/>name,<sp/>old,<sp/>ref-&gt;target);</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">int16_t</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(ref-&gt;target);</highlight></codeline>
<codeline lineno="675"><highlight class="normal">}</highlight></codeline>
<codeline lineno="676"><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>patch_passes(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>&amp;vprg,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>eastl::vector&lt;IndexReplacmentInfo&gt;<sp/>&amp;fsh,</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="679"><highlight class="normal">{</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classShaderClass" kindref="compound">ShaderClass</ref><sp/>*sh<sp/>:<sp/>ctx.storage().shaderClass)</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!sh)</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classShaderCode" kindref="compound">ShaderCode</ref><sp/>*cd<sp/>:<sp/>sh-&gt;code)</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!cd)</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="structShaderCode_1_1Pass" kindref="compound">ShaderCode::Pass</ref><sp/>&amp;p<sp/>:<sp/>cd-&gt;allPasses)</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p.fsh<sp/>=<sp/>patch_index(p.fsh,<sp/>fsh,<sp/></highlight><highlight class="stringliteral">&quot;fsh&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p.vprog<sp/>=<sp/>patch_index(p.vprog,<sp/>vprg,<sp/></highlight><highlight class="stringliteral">&quot;vprog&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal">}</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>dedup_shaders(<ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="700"><highlight class="normal">{</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>vproCount<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>fshCount<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();</highlight></codeline>
<codeline lineno="705"><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>vprogDups<sp/>=<sp/>dedup_table(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>,<sp/></highlight><highlight class="stringliteral">&quot;vprog&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>fshDups<sp/>=<sp/>dedup_table(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>,<sp/></highlight><highlight class="stringliteral">&quot;fsh&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(vprogDups.empty()<sp/>&amp;&amp;<sp/>fshDups.empty())</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;No<sp/>duplicates<sp/>found...&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="714"><highlight class="normal"></highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/>patch_passes(vprogDups,<sp/>fshDups,<sp/>ctx);</highlight></codeline>
<codeline lineno="716"><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/>vprogDups<sp/>=<sp/>empty_fill_table(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>,<sp/></highlight><highlight class="stringliteral">&quot;vprog&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/>fshDups<sp/>=<sp/>empty_fill_table(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>,<sp/></highlight><highlight class="stringliteral">&quot;fsh&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="719"><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/>patch_passes(vprogDups,<sp/>fshDups,<sp/>ctx);</highlight></codeline>
<codeline lineno="721"><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Removed<sp/>%u<sp/>(%u<sp/>-<sp/>%u)<sp/>vprogs...&quot;</highlight><highlight class="normal">,<sp/>vproCount<sp/>-<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size(),<sp/>vproCount,<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size());</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/>REPORT(</highlight><highlight class="stringliteral">&quot;Removed<sp/>%u<sp/>(%u<sp/>-<sp/>%u)<sp/>fshs...&quot;</highlight><highlight class="normal">,<sp/>fshCount<sp/>-<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size(),<sp/>fshCount,<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size());</highlight></codeline>
<codeline lineno="724"><highlight class="normal">}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1aa120dd755705808199f189664dd5edce" kindref="member">recompile_shaders</ref>(<ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="727"><highlight class="normal">{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceshc_1abe61f9b56246b7ac56d190cf23d55011" kindref="member">shc::is_multithreaded</ref>())</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/>eastl::vector&lt;RecompileVPRogJob&gt;<sp/>vprogRecompileJobList;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/>eastl::vector&lt;RecompilePShJob&gt;<sp/>fshRecompileJobList;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/>eastl::vector&lt;RecompileJobBase<sp/>*&gt;<sp/>allJobs;</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/>vprogRecompileJobList.reserve(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size());</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/>fshRecompileJobList.reserve(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size());</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>generate<sp/>all<sp/>jobs<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();<sp/>++i)</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>vprogRecompileJobList.emplace_back(i,<sp/>ctx);</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();<sp/>++i)</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fshRecompileJobList.emplace_back(i,<sp/>ctx);</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="747"><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/>allJobs.reserve(vprogRecompileJobList.size()<sp/>+<sp/>fshRecompileJobList.size());</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>interleave<sp/>pix<sp/>and<sp/>vertex<sp/>prog<sp/>recompile<sp/>to<sp/>more<sp/>evenly<sp/>spread<sp/>the<sp/>work<sp/>load</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>vpAdded<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>fhAdded<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>((vpAdded<sp/>&lt;<sp/>vprogRecompileJobList.size())<sp/>||<sp/>(fhAdded<sp/>&lt;<sp/>fshRecompileJobList.size()))</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(vpAdded<sp/>&lt;<sp/>vprogRecompileJobList.size())</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>allJobs.push_back(&amp;vprogRecompileJobList[vpAdded++]);</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fhAdded<sp/>&lt;<sp/>fshRecompileJobList.size())</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>allJobs.push_back(&amp;fshRecompileJobList[fhAdded++]);</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="764"><highlight class="normal"></highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>issueCount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(issueCount<sp/>&lt;<sp/>allJobs.size())</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceshc_1a196bec5ea00287d23be548089457adff" kindref="member">shc::add_job</ref>(allJobs[issueCount++],<sp/><ref refid="namespaceshc_1a053e03af98ca26e8ba24b8ac5f78fa45a9b3d3b71c41c604f6de20bd2280df393" kindref="member">shc::JobMgrChoiceStrategy::LEAST_BUSY_COOPERATIVE</ref>);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceshc_1aa29b1afa394d7f6e2b8d62ef87c3a88f" kindref="member">shc::await_all_jobs</ref>();</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();<sp/>++i)</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RecompileVPRogJob<sp/>job{i,<sp/>ctx};</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>job.doJob();</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>job.releaseJob();</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();<sp/>++i)</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RecompilePShJob<sp/>job{i,<sp/>ctx};</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>job.doJob();</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>job.releaseJob();</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/>dedup_shaders(ctx);</highlight></codeline>
<codeline lineno="788"><highlight class="normal">}</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a96fa1850596561b85a77a8b6e78407fd" kindref="member">add_stcode</ref>(dag::ConstSpan&lt;int&gt;<sp/>code,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="792"><highlight class="normal">{</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="794"><highlight class="normal"></highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!code.size())</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>.size()<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>[i].size()<sp/>==<sp/>code.size()<sp/>&amp;&amp;<sp/>mem_eq(code,<sp/>stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>[i].data()))</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>append_items(stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>[i].Tab&lt;</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">&gt;::operator=(code);</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>[i].shrink_to_fit();</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="806"><highlight class="normal">}</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1ace100897f3e189920a57708fbc77bbaa" kindref="member">add_stcode_validation_mask</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>stcode_id,<sp/>shader_layout::StcodeConstValidationMask<sp/>*mask,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="809"><highlight class="normal">{</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stcode_id<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="812"><highlight class="normal"></highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/>G_ASSERT(mask);</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;masks<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1a41bea837412e12aed8b376ca3180fd07" kindref="member">stcodeConstValidationMasks</ref>;</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(masks.size()<sp/>&lt;=<sp/>stcode_id)</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/>masks.resize(stcode_id<sp/>+<sp/>1,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dst<sp/>=<sp/>masks[stcode_id];</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dst)</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/>dst-&gt;merge(*mask);</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/>dst<sp/>=<sp/>mask;</highlight></codeline>
<codeline lineno="822"><highlight class="normal">}</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>add_render_state(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>shaders::RenderState<sp/>&amp;rs,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="825"><highlight class="normal">{</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1a190fcb4bc8b6b40e11e3df50a8ad41a3" kindref="member">renderStates</ref>.size();<sp/>++i)</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rs<sp/>==<sp/>stor.<ref refid="structShaderTargetStorage_1a190fcb4bc8b6b40e11e3df50a8ad41a3" kindref="member">renderStates</ref>[i])</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a190fcb4bc8b6b40e11e3df50a8ad41a3" kindref="member">renderStates</ref>.push_back(rs);</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">int</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(stor.<ref refid="structShaderTargetStorage_1a190fcb4bc8b6b40e11e3df50a8ad41a3" kindref="member">renderStates</ref>.size())<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="833"><highlight class="normal">}</highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>add_render_state(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structSemanticShaderPass" kindref="compound">SemanticShaderPass</ref><sp/>&amp;state,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="836"><highlight class="normal">{</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/>shaders::RenderState<sp/>rs;</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/>rs.ztest<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ab0bf024e5d47d170324896dce4762b99" kindref="member">z_test</ref><sp/>!=<sp/>0<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/>rs.zwrite<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1adc658424eab012dc9714430d63be6a1f" kindref="member">z_write</ref><sp/>!=<sp/>0<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state.<ref refid="structSemanticShaderPass_1ab0bf024e5d47d170324896dce4762b99" kindref="member">z_test</ref>)</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.zFunc<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ad261baacf1cbe7bbced475127b318768" kindref="member">z_func</ref>;</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(state.<ref refid="structSemanticShaderPass_1a7f68cf1f427cdeefc9d6f379379f9f10" kindref="member">stencil</ref>)</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.stencilRef<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1afd0a12e229c1ec543d65c9646e0e680c" kindref="member">stencil_ref</ref>;</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.stencil.func<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1aade5d357409294c748420181a8804bdd" kindref="member">stencil_func</ref>;</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.stencil.fail<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ace43b6711eb9fe520f0f02f0b6c421a2" kindref="member">stencil_fail</ref>;</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.stencil.zFail<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a0be11a73500cb0f4f5a8be6fb39076bc" kindref="member">stencil_zfail</ref>;</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.stencil.pass<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a98c200dcef0d75d4551506eb1d5d48b7" kindref="member">stencil_pass</ref>;</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.stencil.readMask<sp/>=<sp/>rs.stencil.writeMask<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a583438567acd98d925687a9c95e330d8" kindref="member">stencil_mask</ref>;</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!state.<ref refid="structSemanticShaderPass_1afe3a630185f7c1448f9f50ac3a9108f5" kindref="member">force_noablend</ref>)</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.independentBlendEnabled<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ad4ff83ab835a58805addbcca7492ebfe" kindref="member">independent_blending</ref>;</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.dualSourceBlendEnabled<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1aba89d35638c7caa0e1c5967554c36304" kindref="member">dual_source_blending</ref>;</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.blendFactor<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1aaaf05343f2a887f2de92a33a329c03af" kindref="member">blend_factor</ref>;</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.blendFactorUsed<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a96edda45ee81cf38bb81baeec422e2b9" kindref="member">blend_factor_specified</ref>;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rs.dualSourceBlendEnabled)</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.ablendFactors.src<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a7ddc29244ba230d69eb7475799d62090" kindref="member">blend_src</ref>[0];</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.ablendFactors.dst<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a675a659d17bd94d8f8303752deddc5b2" kindref="member">blend_dst</ref>[0];</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.sepablendFactors.src<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a69bc37ba9af5f2f50eb3202c11d9da5b" kindref="member">blend_asrc</ref>[0];</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.sepablendFactors.dst<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ab4e5c742d3d758b998dc8d58646ac019" kindref="member">blend_adst</ref>[0];</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.ablend<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a7ddc29244ba230d69eb7475799d62090" kindref="member">blend_src</ref>[0]<sp/>&gt;=<sp/>0<sp/>&amp;&amp;<sp/>state.<ref refid="structSemanticShaderPass_1a675a659d17bd94d8f8303752deddc5b2" kindref="member">blend_dst</ref>[0]<sp/>&gt;=<sp/>0<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.sepablend<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a69bc37ba9af5f2f50eb3202c11d9da5b" kindref="member">blend_asrc</ref>[0]<sp/>&gt;=<sp/>0<sp/>&amp;&amp;<sp/>state.<ref refid="structSemanticShaderPass_1ab4e5c742d3d758b998dc8d58646ac019" kindref="member">blend_adst</ref>[0]<sp/>&gt;=<sp/>0<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.blendOp<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a6c40dba0ddca2a26f062ae6ccefe32d7" kindref="member">blend_op</ref>[0];</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rs.dualSourceBlend.params.sepablendOp<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a98b534cca73cdf01921cd2a4bc1261b6" kindref="member">blend_aop</ref>[0];</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint32_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>shaders::RenderState::NumIndependentBlendParameters;<sp/>i++)</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].ablendFactors.src<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a7ddc29244ba230d69eb7475799d62090" kindref="member">blend_src</ref>[i];</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].ablendFactors.dst<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a675a659d17bd94d8f8303752deddc5b2" kindref="member">blend_dst</ref>[i];</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].sepablendFactors.src<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a69bc37ba9af5f2f50eb3202c11d9da5b" kindref="member">blend_asrc</ref>[i];</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].sepablendFactors.dst<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ab4e5c742d3d758b998dc8d58646ac019" kindref="member">blend_adst</ref>[i];</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].ablend<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a7ddc29244ba230d69eb7475799d62090" kindref="member">blend_src</ref>[i]<sp/>&gt;=<sp/>0<sp/>&amp;&amp;<sp/>state.<ref refid="structSemanticShaderPass_1a675a659d17bd94d8f8303752deddc5b2" kindref="member">blend_dst</ref>[i]<sp/>&gt;=<sp/>0<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].sepablend<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a69bc37ba9af5f2f50eb3202c11d9da5b" kindref="member">blend_asrc</ref>[i]<sp/>&gt;=<sp/>0<sp/>&amp;&amp;<sp/>state.<ref refid="structSemanticShaderPass_1ab4e5c742d3d758b998dc8d58646ac019" kindref="member">blend_adst</ref>[i]<sp/>&gt;=<sp/>0<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].blendOp<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a6c40dba0ddca2a26f062ae6ccefe32d7" kindref="member">blend_op</ref>[i];</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rs.blendParams[i].sepablendOp<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a98b534cca73cdf01921cd2a4bc1261b6" kindref="member">blend_aop</ref>[i];</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.independentBlendEnabled<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.dualSourceBlendEnabled<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.blendFactorUsed<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;blendParam<sp/>:<sp/>rs.blendParams)</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>blendParam.ablend<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>blendParam.sepablend<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/>rs.blendFactor<sp/>=<sp/>E3DCOLOR{0u};</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/>rs.cull<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1aa7e5cf7b15d913c7dd5d0297df99bc8f" kindref="member">cull_mode</ref>;</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/>rs.alphaToCoverage<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a3dcbc5389573f47fcccad6dcce354c42" kindref="member">alpha_to_coverage</ref>;</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/>rs.viewInstanceCount<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a3fcdfe39fe1ec4994be0ccd1b7018e6a" kindref="member">view_instances</ref>;</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/>rs.colorWr<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ac0d4c616a51fc2af2ca90c2f16715d96" kindref="member">color_write</ref>;</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/>rs.zBias<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1a9ab702fa03a317c3124275ecda1289a9" kindref="member">z_bias</ref><sp/>?<sp/>-state.<ref refid="structSemanticShaderPass_1a22e0377ab73defcfc71d7258a617c1f5" kindref="member">z_bias_val</ref><sp/>/<sp/>1000.f<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/>rs.slopeZBias<sp/>=<sp/>state.<ref refid="structSemanticShaderPass_1ad6663916487140d0dba2b427eef126cf" kindref="member">slope_z_bias</ref><sp/>?<sp/>state.<ref refid="structSemanticShaderPass_1ab92d35f5c57fd9cd96f83b7004ae1744" kindref="member">slope_z_bias_val</ref><sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="903"><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>add_render_state(rs,<sp/>ctx);</highlight></codeline>
<codeline lineno="905"><highlight class="normal">}</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ld_add_fshader(<ref refid="classSerializableTab" kindref="compound">TabFsh</ref><sp/>&amp;code,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>upper,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="908"><highlight class="normal">{</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="910"><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!code.size())</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="913"><highlight class="normal"></highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>upper;<sp/>++i)</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i].size()<sp/>==<sp/>code.size()<sp/>&amp;&amp;<sp/>mem_eq(code,<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i].data()))</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="917"><highlight class="normal"></highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>append_items(stor.<ref refid="structShaderTargetStorage_1a515df00f7403d2a15584b3a8e4bb691d" kindref="member">ldShFsh</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a515df00f7403d2a15584b3a8e4bb691d" kindref="member">ldShFsh</ref>[i]<sp/>=<sp/>eastl::move(code);</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a515df00f7403d2a15584b3a8e4bb691d" kindref="member">ldShFsh</ref>[i].shrink_to_fit();</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.push_back(stor.<ref refid="structShaderTargetStorage_1a515df00f7403d2a15584b3a8e4bb691d" kindref="member">ldShFsh</ref>[i]);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="923"><highlight class="normal">}</highlight></codeline>
<codeline lineno="924"><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ld_add_vprog(<ref refid="classSerializableTab" kindref="compound">TabVpr</ref><sp/>&amp;code,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>upper,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="926"><highlight class="normal">{</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="928"><highlight class="normal"></highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!code.size())</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="931"><highlight class="normal"></highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>upper;<sp/>++i)</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i].size()<sp/>==<sp/>code.size()<sp/>&amp;&amp;<sp/>mem_eq(code,<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i].data()))</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="935"><highlight class="normal"></highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>append_items(stor.<ref refid="structShaderTargetStorage_1a1ecbcf175060ab78685c7bfb1ada6d3f" kindref="member">ldShVpr</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a1ecbcf175060ab78685c7bfb1ada6d3f" kindref="member">ldShVpr</ref>[i]<sp/>=<sp/>eastl::move(code);</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1a1ecbcf175060ab78685c7bfb1ada6d3f" kindref="member">ldShVpr</ref>[i].shrink_to_fit();</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.push_back(stor.<ref refid="structShaderTargetStorage_1a1ecbcf175060ab78685c7bfb1ada6d3f" kindref="member">ldShVpr</ref>[i]);</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size()<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="941"><highlight class="normal">}</highlight></codeline>
<codeline lineno="942"><highlight class="normal"></highlight></codeline>
<codeline lineno="943"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a4bf07cae8abae5fa8dfc3d872402bac8" kindref="member">count_shader_stats</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>&amp;uniqueFshBytesInFile,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>&amp;uniqueFshCountInFile,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>&amp;uniqueVprBytesInFile,</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>&amp;uniqueVprCountInFile,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>&amp;stcodeBytes,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="945"><highlight class="normal">{</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="947"><highlight class="normal"></highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/>uniqueFshCountInFile<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/>uniqueVprCountInFile<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/>uniqueFshBytesInFile<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/>uniqueVprBytesInFile<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/>stcodeBytes<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="955"><highlight class="normal"></highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();<sp/>i++)</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/>uniqueFshBytesInFile<sp/>+=<sp/>data_size(stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>[i]);</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();<sp/>i++)</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/>uniqueVprBytesInFile<sp/>+=<sp/>data_size(stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>[i]);</highlight></codeline>
<codeline lineno="960"><highlight class="normal"></highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>.size();<sp/>i++)</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/>stcodeBytes<sp/>+=<sp/>data_size(stor.<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>[i]);</highlight></codeline>
<codeline lineno="963"><highlight class="normal">}</highlight></codeline>
<codeline lineno="964"><highlight class="normal"></highlight></codeline>
<codeline lineno="965"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>link_shaders_fsh_and_vpr(<ref refid="structShadersBindump" kindref="compound">ShadersBindump</ref><sp/>&amp;bindump,<sp/>Tab&lt;int&gt;<sp/>&amp;fsh_lnktbl,<sp/>Tab&lt;int&gt;<sp/>&amp;vpr_lnktbl,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="966"><highlight class="normal">{</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><ref refid="structShaderTargetStorage" kindref="compound">ShaderTargetStorage</ref><sp/>&amp;stor<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>();</highlight></codeline>
<codeline lineno="968"><highlight class="normal"></highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>load<sp/>FSH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fshNum<sp/>=<sp/>bindump.<ref refid="structShadersBindump_1a87687384dbf3c31e138b51d0bbd80a89" kindref="member">shadersFsh</ref>.size();</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/>fsh_lnktbl.resize(fshNum);</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>upper<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1a9bcc46da3435305ae5839982a53fb252" kindref="member">shadersFsh</ref>.size();</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>fshNum;<sp/>i++)</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/>fsh_lnktbl[i]<sp/>=<sp/>ld_add_fshader(bindump.<ref refid="structShadersBindump_1a87687384dbf3c31e138b51d0bbd80a89" kindref="member">shadersFsh</ref>[i],<sp/>upper,<sp/>ctx);</highlight></codeline>
<codeline lineno="975"><highlight class="normal"></highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>load<sp/>VPR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>vprNum<sp/>=<sp/>bindump.<ref refid="structShadersBindump_1a3ea706eacea53a31cfdd8a685b5d2983" kindref="member">shadersVpr</ref>.size();</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/>vpr_lnktbl.resize(vprNum);</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/>upper<sp/>=<sp/>stor.<ref refid="structShaderTargetStorage_1abf97a9489a9d2226004ae01b0c38d638" kindref="member">shadersVpr</ref>.size();</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>vprNum;<sp/>i++)</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/>vpr_lnktbl[i]<sp/>=<sp/>ld_add_vprog(bindump.<ref refid="structShadersBindump_1a3ea706eacea53a31cfdd8a685b5d2983" kindref="member">shadersVpr</ref>[i],<sp/>upper,<sp/>ctx);</highlight></codeline>
<codeline lineno="982"><highlight class="normal">}</highlight></codeline>
<codeline lineno="983"><highlight class="normal"></highlight></codeline>
<codeline lineno="984"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a305d00d1fd0fdba5682b501ae71abe7b" kindref="member">load_shaders_bindump</ref>(<ref refid="structShadersBindump" kindref="compound">ShadersBindump</ref><sp/>&amp;<ref refid="namespaceshaders" kindref="compound">shaders</ref>,<sp/>bindump::IReader<sp/>&amp;full_file_reader,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="985"><highlight class="normal">{</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><ref refid="structShadersDeSerializationScope" kindref="compound">ShadersDeSerializationScope</ref><sp/>deSerScope{ctx};</highlight></codeline>
<codeline lineno="987"><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><ref refid="structCompressedShadersBindump" kindref="compound">CompressedShadersBindump</ref><sp/>compressed;</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/>bindump::streamRead(compressed,<sp/>full_file_reader);</highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(compressed.<ref refid="structCompressedShadersBindump_1ad676cf4e01ce5b406b14b15b07995bbf" kindref="member">eof</ref><sp/>!=<sp/><ref refid="shCacheVer_8h_1a385c44f6fb256e5716a2302a5b940388a516ba23eb35871282c44f4019f63a30b" kindref="member">SHADER_CACHE_EOF</ref>)</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="993"><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/>eastl::vector&lt;uint8_t&gt;<sp/>decompressed_data;</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(compressed.<ref refid="structCompressedShadersBindump_1a722663c55a1b03bbb7720165212b8eb0" kindref="member">decompressed_size</ref><sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/>decompressed_data.resize(compressed.<ref refid="structCompressedShadersBindump_1a722663c55a1b03bbb7720165212b8eb0" kindref="member">decompressed_size</ref>);</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>decompressed_size<sp/>=<sp/>zstd_decompress(decompressed_data.data(),<sp/>decompressed_data.size(),</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.data(),<sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.size());</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/>G_ASSERT(decompressed_size<sp/>==<sp/>compressed.<ref refid="structCompressedShadersBindump_1a722663c55a1b03bbb7720165212b8eb0" kindref="member">decompressed_size</ref>);</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>decompressed_data<sp/>=<sp/>eastl::move(compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>);</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/>bindump::MemoryReader<sp/>reader(decompressed_data.data(),<sp/>decompressed_data.size());</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/>bindump::streamRead(<ref refid="namespaceshaders" kindref="compound">shaders</ref>,<sp/>reader);</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a80685ae901a05b19dd81461d6117456a" kindref="member">link_scripted_shaders</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*mapped_data,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>data_size,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*filename,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*source_name,</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="1014"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><ref refid="structShadersBindump" kindref="compound">ShadersBindump</ref><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>;</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/>bindump::MemoryReader<sp/>compressed_reader(mapped_data,<sp/>data_size);</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="linkShaders_8cpp_1a305d00d1fd0fdba5682b501ae71abe7b" kindref="member">load_shaders_bindump</ref>(<ref refid="namespaceshaders" kindref="compound">shaders</ref>,<sp/>compressed_reader,<sp/>ctx))</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5ca6112bd3e7c5d175bac1569c33c1630ad" kindref="member">SHLOG_FATAL</ref>,<sp/></highlight><highlight class="stringliteral">&quot;corrupted<sp/>OBJ<sp/>file:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>filename);</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>render<sp/>states</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>renderStatesCount<sp/>=<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.renderStates.size();</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/>Tab&lt;int&gt;<sp/>renderStateLinkTable(tmpmem);</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/>renderStateLinkTable.resize(renderStatesCount);</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>renderStatesCount;<sp/>++i)</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/>renderStateLinkTable[i]<sp/>=<sp/>add_render_state(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.renderStates[i],<sp/>ctx);</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"></highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/>Tab&lt;int&gt;<sp/>fsh_lnktbl(tmpmem);</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/>Tab&lt;int&gt;<sp/>vpr_lnktbl(tmpmem);</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/>link_shaders_fsh_and_vpr(<ref refid="namespaceshaders" kindref="compound">shaders</ref>,<sp/>fsh_lnktbl,<sp/>vpr_lnktbl,<sp/>ctx);</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>stcode.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/>Tab&lt;TabStcode&gt;<sp/>&amp;shaderStcodeFromFile<sp/>=<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shadersStcode;</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/>Tab&lt;int&gt;<sp/>global_var_link_table(tmpmem);</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/>Tab&lt;ShaderVariant::ExtType&gt;<sp/>interval_link_table(tmpmem);</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a77a4453b2a7ddead5199305bd6205fa1" kindref="member">globVars</ref>().<ref refid="classShaderGlobal_1_1VarTable_1adaea19d3622b083f0956c64981055164" kindref="member">link</ref>(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.variable_list,<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.intervals,<sp/>global_var_link_table,<sp/>interval_link_table);</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/>Tab&lt;int&gt;<sp/>smp_link_table;</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a752f5f70f8d04a70f87a34102a85f83a" kindref="member">samplers</ref>().<ref refid="classSamplerTable_1a29ec9847d0c38b0b5068d5cba1689eab" kindref="member">link</ref>(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.static_samplers,<sp/>smp_link_table);</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"></highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Link<sp/>stcode,<sp/>stblkcode.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/>Tab&lt;int&gt;<sp/>stcode_lnktbl(tmpmem);</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/>stcode_lnktbl.resize(shaderStcodeFromFile.size());</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>shaderStcodeFromFile.size();<sp/>i++)</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacebindumphlp_1a9dd98856dab0c04401d3b4d8dafac9be" kindref="member">bindumphlp::patchStCode</ref>(make_span(shaderStcodeFromFile[i]),<sp/>global_var_link_table,<sp/>smp_link_table);</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/>stcode_lnktbl[i]<sp/>=<sp/><ref refid="linkShaders_8cpp_1a96fa1850596561b85a77a8b6e78407fd" kindref="member">add_stcode</ref>(shaderStcodeFromFile[i],<sp/>ctx);</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().generateCppStcodeValidationData)</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="linkShaders_8cpp_1ace100897f3e189920a57708fbc77bbaa" kindref="member">add_stcode_validation_mask</ref>(stcode_lnktbl[i],<sp/>eastl::exchange(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.stcodeConstMasks[i],<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">),<sp/>ctx);</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"></highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;ptr<sp/>:<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.stcodeConstMasks)</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ptr)</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>eastl::exchange(ptr,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"></highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Link<sp/>cpp<sp/>stcode,<sp/>and<sp/>save<sp/>routine<sp/>remapping<sp/>table<sp/>to<sp/>fill<sp/>pass<sp/>indices</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[dynamicCppStcodeRemappingTable,<sp/>staticCppStcodeRemappingTable]<sp/>=</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1ac8074e036f8c87ab87d9b9567faca319" kindref="member">linkRoutinesFromFile</ref>(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.dynamicCppcodeHashes,<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.staticCppcodeHashes,<sp/>source_name);</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"></highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Link<sp/>blocks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a29da580ffb2850a459e34b407e0e57ed" kindref="member">blocks</ref>().<ref refid="classShaderBlockTable_1a969c81dcaa52660a6012dd5213705719" kindref="member">link</ref>(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.state_blocks,<sp/>stcode_lnktbl,<sp/>dynamicCppStcodeRemappingTable);</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"></highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>load<sp/>shaders</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1abfaaaacd1519890b902eb99112e8b850" kindref="member">shaderClass</ref>.reserve(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.shaderClasses.size());</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"></highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>branched<sp/>cpp<sp/>stcode,<sp/>filled<sp/>along<sp/>the<sp/>way</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/>eastl::vector_map&lt;int,<sp/>int&gt;<sp/>dynamicOffsetRemappingTable{};</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"></highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classShaderClass" kindref="compound">ShaderClass</ref><sp/>*classFromFile<sp/>:<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shaderClasses)</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classShaderClass" kindref="compound">ShaderClass</ref><sp/>*existingClass<sp/>:<sp/>ctx.storage().shaderClass)</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(existingClass-&gt;name<sp/>==<sp/>classFromFile-&gt;name)</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5caae3b70b41400c8a36e8a094ac1dbe43c" kindref="member">SHLOG_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Duplicated<sp/>shader<sp/>&apos;%s&apos;&quot;</highlight><highlight class="normal">,<sp/>classFromFile-&gt;name.c_str());</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"></highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>total_passes<sp/>=<sp/>0,<sp/>reduced_passes<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"></highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/>classFromFile-&gt;staticVariants.setContextRef(ctx);</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/>classFromFile-&gt;staticVariants.linkIntervalList();</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classShaderCode" kindref="compound">ShaderCode</ref><sp/>*code<sp/>:<sp/>classFromFile-&gt;code)</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>id;</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;link(ctx);</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;dynVariants.setContextRef(ctx);</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;dynVariants.link(interval_link_table);</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"></highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(code-&gt;branchedCppStcodeId<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(code-&gt;branchedCppStcodeId<sp/>&lt;<sp/>dynamicCppStcodeRemappingTable.size());</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;branchedCppStcodeId<sp/>=<sp/>dynamicCppStcodeRemappingTable[code-&gt;branchedCppStcodeId];</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(code-&gt;branchedCppStblkcodeId<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(code-&gt;branchedCppStblkcodeId<sp/>&lt;<sp/>staticCppStcodeRemappingTable.size());</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;branchedCppStblkcodeId<sp/>=<sp/>staticCppStcodeRemappingTable[code-&gt;branchedCppStblkcodeId];</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="structShaderCode_1_1Pass" kindref="compound">ShaderCode::Pass</ref><sp/>&amp;pass<sp/>:<sp/>code-&gt;allPasses)</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.fsh<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.fsh<sp/>&lt;<sp/>fsh_lnktbl.size());</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/>fsh_lnktbl[pass.fsh];</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.fsh<sp/>=<sp/>id;</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERTF(pass.fsh<sp/>==<sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;pass.fsh=%d<sp/><sp/>id=%d&quot;</highlight><highlight class="normal">,<sp/>pass.fsh,<sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"></highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.vprog<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.vprog<sp/>&lt;<sp/>vpr_lnktbl.size());</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal"><sp/>=<sp/>vpr_lnktbl[pass.vprog];</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.vprog<sp/>=<sp/>id;</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERTF(pass.vprog<sp/>==<sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;pass.vprog=%d<sp/><sp/>id=%d&quot;</highlight><highlight class="normal">,<sp/>pass.vprog,<sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.stcodeNo<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.stcodeNo<sp/>&lt;<sp/>stcode_lnktbl.size());</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.stcodeNo<sp/>=<sp/>stcode_lnktbl[pass.stcodeNo];</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.stblkcodeNo<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.stblkcodeNo<sp/>&lt;<sp/>stcode_lnktbl.size());</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.stblkcodeNo<sp/>=<sp/>stcode_lnktbl[pass.stblkcodeNo];</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"></highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.branchlessCppStcodeId<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.branchlessCppStcodeId<sp/>&lt;<sp/>dynamicCppStcodeRemappingTable.size());</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.branchlessCppStcodeId<sp/>=<sp/>dynamicCppStcodeRemappingTable[pass.branchlessCppStcodeId];</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"></highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.branchlessCppStblkcodeId<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.branchlessCppStblkcodeId<sp/>&lt;<sp/>staticCppStcodeRemappingTable.size());</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.branchlessCppStblkcodeId<sp/>=<sp/>staticCppStcodeRemappingTable[pass.branchlessCppStblkcodeId];</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"></highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.branchedCppStcodeTableOffset<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[it,<sp/>inserted]<sp/>=<sp/>dynamicOffsetRemappingTable.emplace(pass.branchedCppStcodeTableOffset,<sp/>-1);</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inserted)</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>it-&gt;second<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1a36813a7078bf6490784b97e700de11b7" kindref="member">addRegisterTableWithOffset</ref>(</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eastl::move(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.cppcodeRegisterTables[pass.branchedCppStcodeTableOffset]));</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"></highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.branchedCppStcodeTableOffset<sp/>=<sp/>it-&gt;second;</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"></highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.branchedCppStblkcodeTableOffset<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>[it,<sp/>inserted]<sp/>=<sp/>dynamicOffsetRemappingTable.emplace(pass.branchedCppStblkcodeTableOffset,<sp/>-1);</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inserted)</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>it-&gt;second<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1a36813a7078bf6490784b97e700de11b7" kindref="member">addRegisterTableWithOffset</ref>(</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>eastl::move(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.cppcodeRegisterTables[pass.branchedCppStblkcodeTableOffset]));</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"></highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.branchedCppStblkcodeTableOffset<sp/>=<sp/>it-&gt;second;</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pass.renderStateNo<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(pass.renderStateNo<sp/>&lt;<sp/>renderStateLinkTable.size());</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pass.renderStateNo<sp/>=<sp/>renderStateLinkTable[pass.renderStateNo];</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"></highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reduce<sp/>passTabs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SmallTab&lt;int,<sp/>TmpmemAlloc&gt;<sp/>idxmap;</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Tab&lt;ShaderCode::PassTab<sp/>*&gt;<sp/>newpass(midmem);</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"></highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>clear_and_resize(idxmap,<sp/>code-&gt;passes.size());</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mem_set_ff(idxmap);</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"></highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>passNo<sp/>=<sp/>0;<sp/>passNo<sp/>&lt;<sp/>idxmap.size();<sp/>passNo++)</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structShaderCode_1_1PassTab" kindref="compound">ShaderCode::PassTab</ref><sp/>*p<sp/>=<sp/>code-&gt;passes[passNo];</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"></highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>newpass.size();<sp/>i++)</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p<sp/>==<sp/>newpass[i])</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idxmap[passNo]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p<sp/>&amp;&amp;<sp/>newpass[i]<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structShaderCode_1_1PassTab_1ae6a673af2561707440b5b16ee1af51a3" kindref="member">rpass</ref>.get()<sp/>==<sp/>newpass[i]-&gt;rpass.get()<sp/>&amp;&amp;<sp/>p-&gt;<ref refid="structShaderCode_1_1PassTab_1a72990da48c33ec5962477ae0cf0c77fb" kindref="member">suppBlk</ref><sp/>==<sp/>newpass[i]-&gt;suppBlk)</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idxmap[passNo]<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;passes[passNo]<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"></highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(idxmap[passNo]<sp/>==<sp/>-1)</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idxmap[passNo]<sp/>=<sp/>newpass.size();</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newpass.push_back(p);</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"></highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>total_passes<sp/>+=<sp/>idxmap.size();</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>reduced_passes<sp/>+=<sp/>newpass.size();</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"></highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newpass.size()<sp/>&lt;<sp/>idxmap.size())</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>when<sp/>really<sp/>reduced,<sp/>update<sp/>code.dynVariants</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>code-&gt;dynVariants.getVarCount()<sp/>-<sp/>1;<sp/>i<sp/>&gt;=<sp/>0;<sp/>i--)</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>G_ASSERT(code-&gt;dynVariants.getVariant(i)-&gt;codeId<sp/>&lt;<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)idxmap.size());</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(code-&gt;dynVariants.getVariant(i)-&gt;codeId<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;dynVariants.getVariant(i)-&gt;codeId<sp/>=<sp/>idxmap[code-&gt;dynVariants.getVariant(i)-&gt;codeId];</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>code-&gt;passes<sp/>=<sp/>eastl::move(newpass);</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/>ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1abfaaaacd1519890b902eb99112e8b850" kindref="member">shaderClass</ref>.push_back(classFromFile);</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1228"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"></highlight></codeline>
<codeline lineno="1230"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1a3d948e926ac6e6c6574b37fda70e5f41" kindref="member">save_scripted_shaders</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*filename,<sp/>dag::ConstSpan&lt;SimpleString&gt;<sp/>files,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx,</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>need_cppstcode_file_write)</highlight></codeline>
<codeline lineno="1232"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><ref refid="structShadersDeSerializationScope" kindref="compound">ShadersDeSerializationScope</ref><sp/>deSerScope{ctx};</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><ref refid="structCompressedShadersBindump" kindref="compound">CompressedShadersBindump</ref><sp/>compressed;</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><ref refid="structShadersBindump" kindref="compound">ShadersBindump</ref><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>;</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"></highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/>compressed.<ref refid="structShadersBindumpHeader_1a7a28b16040ac57ebb0290f1fc3020266" kindref="member">cache_sign</ref><sp/>=<sp/><ref refid="shCacheVer_8h_1a385c44f6fb256e5716a2302a5b940388aa80b8f72df86b0f06b0df69c8eb4d424" kindref="member">SHADER_CACHE_SIGN</ref>;</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/>compressed.<ref refid="structShadersBindumpHeader_1af5acd824207cfc830a14856704309eb6" kindref="member">cache_version</ref><sp/>=<sp/>SHADER_CACHE_VER;</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/>compressed.<ref refid="structShadersBindumpHeader_1a00aa476b59b6f4ba46073abae37774e1" kindref="member">last_blk_hash</ref><sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a72ea1e47e9286a2dfdf513c56e495712" kindref="member">compCtx</ref>().<ref refid="classshc_1_1CompilationContext_1a8994f2ef66560adc7db8cae292c5ec65" kindref="member">compInfo</ref>().<ref refid="classShCompilationInfo_1a51ba987b41b2c9fdbe000567104f2e26" kindref="member">targetBlkHash</ref>();</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1ad676cf4e01ce5b406b14b15b07995bbf" kindref="member">eof</ref><sp/>=<sp/><ref refid="shCacheVer_8h_1a385c44f6fb256e5716a2302a5b940388a516ba23eb35871282c44f4019f63a30b" kindref="member">SHADER_CACHE_EOF</ref>;</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"></highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>save<sp/>dependens</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>files.size();<sp/>++i)</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>compressed.<ref refid="structShadersBindumpHeader_1ab6b5e1758ece57f5194a0bd9c3516c6d" kindref="member">dependency_files</ref>.emplace_back(files[i].c_str());</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"></highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.variable_list<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a77a4453b2a7ddead5199305bd6205fa1" kindref="member">globVars</ref>().<ref refid="classShaderGlobal_1_1VarTable_1a4dfe6c40fc24b107d212302fd8b4e6e1" kindref="member">getMutableVariableList</ref>());</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.static_samplers<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a752f5f70f8d04a70f87a34102a85f83a" kindref="member">samplers</ref>().<ref refid="classSamplerTable_1a4385cbae1f97351063aa29390f99d48c" kindref="member">releaseSamplers</ref>();</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.intervals<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a77a4453b2a7ddead5199305bd6205fa1" kindref="member">globVars</ref>().<ref refid="classShaderGlobal_1_1VarTable_1afd0083122930c0c8b8a5bbb82729d150" kindref="member">getMutableIntervalList</ref>());</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.empty_block<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a29da580ffb2850a459e34b407e0e57ed" kindref="member">blocks</ref>().<ref refid="classShaderBlockTable_1a439f320715d613f530f4e460d05eaf92" kindref="member">releaseEmptyBlock</ref>();</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.state_blocks<sp/>=<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a29da580ffb2850a459e34b407e0e57ed" kindref="member">blocks</ref>().<ref refid="classShaderBlockTable_1a2d59b777ab3d6b7e1875d8ad295fe560" kindref="member">release</ref>();</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shaderClasses<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1abfaaaacd1519890b902eb99112e8b850" kindref="member">shaderClass</ref>);</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.renderStates<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1a190fcb4bc8b6b40e11e3df50a8ad41a3" kindref="member">renderStates</ref>);</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"></highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().generateCppStcodeValidationData)</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/>G_ASSERT(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.stcodeConstMasks.size()<sp/>==<sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shadersStcode.size());</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/>G_ASSERT(<ref refid="namespaceshaders" kindref="compound">shaders</ref>.stcodeConstMasks.empty());</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"></highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shadersStcode<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1a579932c02829dc347f03fcd70e4bc267" kindref="member">shadersStcode</ref>);</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.stcodeConstMasks<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a6c0de720a215829591233164a231d188" kindref="member">storage</ref>().<ref refid="structShaderTargetStorage_1a41bea837412e12aed8b376ca3180fd07" kindref="member">stcodeConstValidationMasks</ref>);</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"></highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.dynamicCppcodeHashes<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1ae1da4c67798cda2f7e2fbc8be42c8285" kindref="member">dynamicRoutineHashes</ref>);</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.staticCppcodeHashes<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1a4d978241d88464a82844489fcda09685" kindref="member">staticRoutineHashes</ref>);</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.dynamicCppcodeRoutineNames<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1a06e085d179bc8bc3d7291ca7571d9d38" kindref="member">dynamicRoutineNames</ref>);</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.staticCppcodeRoutineNames<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1aa2274b5285ec7958fc49a1ce87d5ac8b" kindref="member">staticRoutineNames</ref>);</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"></highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.cppcodeRegisterTables.reserve(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1a0fc5dcef4db2f3f00b1ceb1655311c00" kindref="member">regTable</ref>.<ref refid="structStcodeShader_1_1RegisterTable_1ac76a82a19c0444083bab58903faf2d92" kindref="member">combinedTable</ref>.size());</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;&amp;t<sp/>:<sp/>ctx.cppStcode().regTable.combinedTable)</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.cppcodeRegisterTables.push_back(eastl::move(t));</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.cppcodeRegisterTableOffsets<sp/>=<sp/>eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>().<ref refid="structStcodeShader_1a0fc5dcef4db2f3f00b1ceb1655311c00" kindref="member">regTable</ref>.<ref refid="structStcodeShader_1_1RegisterTable_1a5e9b663761faab1a927d1c2d80e077db" kindref="member">offsets</ref>);</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"></highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>save<sp/>FSH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;fsh<sp/>:<sp/>ctx.storage().shadersFsh)</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/>Tab&lt;uint32_t&gt;<sp/>code(fsh,<sp/>tmpmem_ptr());</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shadersFsh.push_back(eastl::move(code));</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"></highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>save<sp/>VPR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;vpr<sp/>:<sp/>ctx.storage().shadersVpr)</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/>Tab&lt;uint32_t&gt;<sp/>code(vpr,<sp/>tmpmem_ptr());</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespaceshaders" kindref="compound">shaders</ref>.shadersVpr.push_back(eastl::move(code));</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"></highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>4gb,<sp/>cause<sp/>eastl<sp/>asserts<sp/>this<sp/>size,<sp/>dag::Vector<sp/>with<sp/>default<sp/>settings<sp/>uses<sp/>32bit<sp/>indices,<sp/>and<sp/>a<sp/>lot<sp/>of<sp/>the<sp/>bindump<sp/>library<sp/>code</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>also<sp/>assumes<sp/>32<sp/>bits<sp/>is<sp/>enough</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">constexpr</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>MAX_UNCOMPRESSED_SIZE<sp/>=<sp/>(1ull<sp/>&lt;&lt;<sp/>32)<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"></highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/>bindump::SizeMetter<sp/>sizeChecker;</highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/>bindump::streamWrite(<ref refid="namespaceshaders" kindref="compound">shaders</ref>,<sp/>sizeChecker);</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"></highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sizeChecker.mSize<sp/>&gt;<sp/>MAX_UNCOMPRESSED_SIZE)</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5ca6112bd3e7c5d175bac1569c33c1630ad" kindref="member">SHLOG_FATAL</ref>,</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;The<sp/>shaders<sp/>bindump<sp/>is<sp/>too<sp/>large<sp/>(%llu<sp/>bytes<sp/>uncompressed,<sp/>doesn&apos;t<sp/>fit<sp/>into<sp/>32-bit<sp/>indexing),<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;consider<sp/>disabling<sp/>global<sp/>debug<sp/>info<sp/>options,<sp/>or<sp/>reducing<sp/>the<sp/>shader<sp/>set&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>sizeChecker.mSize);</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"></highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/>bindump::VectorWriter<sp/>mem_writer;</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/>bindump::streamWrite(<ref refid="namespaceshaders" kindref="compound">shaders</ref>,<sp/>mem_writer);</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"></highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mem_writer.mData.size()<sp/>&gt;<sp/>(1u<sp/>&lt;&lt;<sp/>30))</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.resize(zstd_compress_bound(mem_writer.mData.size()));</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>compressed_size<sp/>=<sp/>zstd_compress(compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.data(),<sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.size(),</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mem_writer.mData.data(),<sp/>mem_writer.mData.size(),<sp/>9);</highlight></codeline>
<codeline lineno="1311"><highlight class="normal"></highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>maxCompressedSize<sp/>=<sp/>0x20000000;</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().constrainCompressedBindumpSize<sp/>&amp;&amp;<sp/>compressed_size<sp/>&gt;<sp/>maxCompressedSize)</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5ca6112bd3e7c5d175bac1569c33c1630ad" kindref="member">SHLOG_FATAL</ref>,</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Compressed<sp/>bindump<sp/>size<sp/>is<sp/>too<sp/>large,<sp/>zstd_compress()<sp/>returns<sp/>%lld<sp/>(0x%llx),<sp/>srcDataSz=%llu<sp/>destBufSz=%llu,<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;while<sp/>cap<sp/>is<sp/>%llu,<sp/>consider<sp/>disabling<sp/>global<sp/>debug<sp/>info<sp/>options,<sp/>or<sp/>reducing<sp/>the<sp/>shader<sp/>set&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(ptrdiff_t)compressed_size,<sp/>compressed_size,<sp/>mem_writer.mData.size(),<sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.size(),<sp/>maxCompressedSize);</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.resize(compressed_size);</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1a722663c55a1b03bbb7720165212b8eb0" kindref="member">decompressed_size</ref><sp/>=<sp/>mem_writer.mData.size();</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.resize(mem_writer.mData.size());</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/>eastl::copy(mem_writer.mData.begin(),<sp/>mem_writer.mData.end(),<sp/>compressed.<ref refid="structCompressedShadersBindump_1a608bf222c046f653259c2fd7f3bc7e24" kindref="member">compressed_shaders</ref>.begin());</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/>compressed.<ref refid="structCompressedShadersBindump_1a722663c55a1b03bbb7720165212b8eb0" kindref="member">decompressed_size</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"></highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/>bindump::writeToFileFast(compressed,<sp/>filename);</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"></highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(need_cppstcode_file_write)</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="cppStcode_8cpp_1a4980391e878d7fd3ebe095517f4c3b23" kindref="member">save_compiled_cpp_stcode</ref>(eastl::move(ctx.<ref refid="classshc_1_1TargetContext_1a27d8cc3aa5ee309d0c1e3fca7ea3cbdf" kindref="member">cppStcode</ref>()),<sp/>ctx.<ref refid="classshc_1_1TargetContext_1a72ea1e47e9286a2dfdf513c56e495712" kindref="member">compCtx</ref>().<ref refid="classshc_1_1CompilationContext_1a8994f2ef66560adc7db8cae292c5ec65" kindref="member">compInfo</ref>());</highlight></codeline>
<codeline lineno="1336"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"></highlight></codeline>
<codeline lineno="1338"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="linkShaders_8cpp_1ada36b76256c8c7e82e285ca2281bb944" kindref="member">update_shaders_timestamps</ref>(dag::ConstSpan&lt;SimpleString&gt;<sp/>dependencies,<sp/><ref refid="classshc_1_1TargetContext" kindref="compound">shc::TargetContext</ref><sp/>&amp;ctx)</highlight></codeline>
<codeline lineno="1339"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Shader<sp/>class<sp/>timestamp<sp/>feature<sp/>is<sp/>only<sp/>used<sp/>for<sp/>DX12</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1341"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>_CROSS_TARGET_DX12</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1342"><highlight class="normal"><sp/><sp/>int64_t<sp/>mostRecentTimestamp<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1343"><highlight class="normal"></highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="namespaceshc_1a47efde6b3d493adbe2119a5593807d36" kindref="member">shc::config</ref>().useGitTimestamps)</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/>mostRecentTimestamp<sp/>=<sp/><ref refid="gitRunner_8cpp_1a4c60856b2a07506f1e3d6f1163bdfc6b" kindref="member">get_git_files_last_commit_timestamp</ref>(dependencies);</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="shLog_8cpp_1a2926179632c7c86265007652d3d30b14" kindref="member">sh_debug</ref>(<ref refid="shLog_8h_1a66042048eb3ce30a1dccb2ebf8c2fd5ca0012c8acb382f295fe614046a64bba11" kindref="member">SHLOG_INFO</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Timestamps<sp/>are<sp/>disabled<sp/>by<sp/>the<sp/>flag<sp/>useGitTimestamps,<sp/>using<sp/>0<sp/>as<sp/>timestamp&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/>G_UNUSED(dependencies);</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/>int64_t<sp/>mostRecentTimestamp<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classShaderClass" kindref="compound">ShaderClass</ref><sp/>*cls<sp/>:<sp/>ctx.storage().shaderClass)</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/>cls-&gt;timestamp<sp/>=<sp/>mostRecentTimestamp;</highlight></codeline>
<codeline lineno="1354"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="linkShaders.cpp"/>
  </compounddef>
</doxygen>
